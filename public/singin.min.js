// @ts-nocheck
import{auth,db}from"./firebase-config.js";import{signInWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";import{doc,getDoc}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";document.querySelectorAll(".toggle").forEach((e=>{e.addEventListener("click",(()=>{const t=e.previousElementSibling;t&&(t.type="password"===t.type?"text":"password",e.textContent="password"===t.type?"ðŸ‘ï¸":"ðŸ™ˆ")}))}));const signInBtn=document.getElementById("signInBtn");signInBtn&&signInBtn.addEventListener("click",(async()=>{const e=document.getElementById("email"),t=document.getElementById("password"),a=(e?.value||"").trim(),o=t?.value||"";if(a&&o)try{const e=(await signInWithEmailAndPassword(auth,a,o)).user,t=doc(db,"users",e.uid),r=await getDoc(t);let l={};r.exists()&&(l=r.data());const s="byverent@gmail.com",n=l.role||(a.toLowerCase()===s.toLowerCase()?"admin":"user"),i=l.name||e.displayName||"",c=l.phone||"";localStorage.setItem("maziRole",n),localStorage.setItem("maziEmail",a),localStorage.setItem("maziName",i),localStorage.setItem("maziPhone",c),localStorage.setItem("maziUID",e.uid),"function"==typeof window.flushOrderQueue&&window.flushOrderQueue().catch((e=>console.warn("flush after sign-in failed",e)));const m=new URLSearchParams(window.location.search).get("from");if("bag"===m||"checkout"===m){try{const e=JSON.parse(localStorage.getItem("checkoutDraft_cart")||"null");e&&(localStorage.setItem("cart",JSON.stringify(e)),localStorage.removeItem("checkoutDraft_cart"))}catch(e){console.warn("failed restore draft",e)}return void(window.location.href="bag"===m?"bagfr.html":"cekout.html")}localStorage.setItem("maziUID",e.uid);try{"function"==typeof window.flushOrderQueue?(await window.flushOrderQueue(),console.log("flushOrderQueue completed after sign-in")):console.log("flushOrderQueue not loaded on this page")}catch(e){console.warn("flushOrderQueue error after sign-in",e)}const d=(i||"").split(/\s+/),u=d[0]||"",g=d.slice(1).join(" "),f=localStorage.getItem("profile");let w=null;try{w=JSON.parse(f||"null")}catch{w=null}w=w&&(w.email||"").toLowerCase()===a.toLowerCase()?{...w,firstName:u,lastName:g,phone:c||w.phone}:{firstName:u,lastName:g,email:a,phone:c,memberSince:l.memberSince||(new Date).getFullYear()},localStorage.setItem("profile",JSON.stringify(w)),window.location.href="admin"===n?"frsadm.html":"Home.html"}catch(e){console.error(e);let t="Gagal login. Cek lagi email dan password ya ðŸ™‚";"auth/user-not-found"===e.code?t="Email belum terdaftar. Silakan Sign Up dulu ya ðŸ™‚":"auth/wrong-password"===e.code?t="Password salah. Coba lagi ya ðŸ˜Š":"auth/invalid-email"===e.code&&(t="Format email tidak valid."),alert(t)}else alert("Isi email dan password dulu ya ðŸ™‚")}));