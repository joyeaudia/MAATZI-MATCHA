// @ts-nocheck
import{auth,db}from"./firebase-config.js";import{signInWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";import{doc,getDoc}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";document.querySelectorAll(".toggle").forEach((e=>{e.addEventListener("click",(()=>{const t=e.previousElementSibling;t&&(t.type="password"===t.type?"text":"password",e.textContent="password"===t.type?"ðŸ‘ï¸":"ðŸ™ˆ")}))}));const signInBtn=document.getElementById("signInBtn");signInBtn&&signInBtn.addEventListener("click",(async()=>{const e=document.getElementById("email"),t=document.getElementById("password"),a=(e?.value||"").trim(),o=t?.value||"";if(a&&o)try{const e=(await signInWithEmailAndPassword(auth,a,o)).user,t=doc(db,"users",e.uid),s=await getDoc(t);let l={};s.exists()&&(l=s.data());const i="byverent@gmail.com",r=l.role||(a.toLowerCase()===i.toLowerCase()?"admin":"user"),n=l.name||e.displayName||"",m=l.phone||"";localStorage.setItem("maziRole",r),localStorage.setItem("maziEmail",a),localStorage.setItem("maziName",n),localStorage.setItem("maziPhone",m),localStorage.setItem("maziUID",e.uid);try{"function"==typeof window.flushOrderQueue?(await window.flushOrderQueue(),console.log("flushOrderQueue completed after sign-in")):console.log("flushOrderQueue not loaded on this page")}catch(e){console.warn("flushOrderQueue error after sign-in",e)}const d=(n||"").split(/\s+/),c=d[0]||"",u=d.slice(1).join(" "),g=localStorage.getItem("profile");let w=null;try{w=JSON.parse(g||"null")}catch{w=null}w=w&&(w.email||"").toLowerCase()===a.toLowerCase()?{...w,firstName:c,lastName:u,phone:m||w.phone}:{firstName:c,lastName:u,email:a,phone:m,memberSince:l.memberSince||(new Date).getFullYear()},localStorage.setItem("profile",JSON.stringify(w)),window.location.href="admin"===r?"frsadm.html":"Home.html"}catch(e){console.error(e);let t="Gagal login. Cek lagi email dan password ya ðŸ™‚";"auth/user-not-found"===e.code?t="Email belum terdaftar. Silakan Sign Up dulu ya ðŸ™‚":"auth/wrong-password"===e.code?t="Password salah. Coba lagi ya ðŸ˜Š":"auth/invalid-email"===e.code&&(t="Format email tidak valid."),alert(t)}else alert("Isi email dan password dulu ya ðŸ™‚")}));