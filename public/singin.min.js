// @ts-nocheck
import{auth,db}from"./firebase-config.js";import{signInWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";import{doc,getDoc}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";const ADMIN_EMAIL="byverent@gmail.com";document.querySelectorAll(".toggle").forEach((e=>{e.addEventListener("click",(()=>{const t=e.previousElementSibling;t&&(t.type="password"===t.type?"text":"password",e.textContent="password"===t.type?"ðŸ‘ï¸":"ðŸ™ˆ")}))}));const signInBtn=document.getElementById("signInBtn");signInBtn&&signInBtn.addEventListener("click",(async()=>{const e=document.getElementById("email"),t=document.getElementById("password"),a=(e?.value||"").trim(),o=t?.value||"";if(a&&o)try{const e=(await signInWithEmailAndPassword(auth,a,o)).user,t=doc(db,"users",e.uid),r=await getDoc(t);let s={};r.exists()&&(s=r.data());let l="user";s.role?l=s.role:a.toLowerCase()===ADMIN_EMAIL.toLowerCase()&&(l="admin");const n=s.name||e.displayName||"",i=s.phone||"";localStorage.setItem("maziRole",l),localStorage.setItem("maziEmail",a),localStorage.setItem("maziName",n),localStorage.setItem("maziPhone",i),localStorage.setItem("maziUID",e.uid);try{"function"==typeof window.flushOrderQueue&&window.flushOrderQueue().catch((e=>console.warn("flush after sign-in failed",e)))}catch(e){console.warn("flushOrderQueue throw",e)}const c=new URLSearchParams(window.location.search).get("from");if("bag"===c||"checkout"===c){try{const e=JSON.parse(localStorage.getItem("checkoutDraft_cart")||"null");e&&(localStorage.setItem("cart",JSON.stringify(e)),localStorage.removeItem("checkoutDraft_cart"))}catch(e){console.warn("failed restore draft",e)}return void(window.location.href="bag"===c?"bagfr.html":"cekout.html")}const m=(n||"").split(/\s+/),d=m[0]||"",u=m.slice(1).join(" "),g=localStorage.getItem("profile");let w=null;try{w=JSON.parse(g||"null")}catch{w=null}w=w&&(w.email||"").toLowerCase()===a.toLowerCase()?{...w,firstName:d,lastName:u,phone:i||w.phone}:{firstName:d,lastName:u,email:a,phone:i,memberSince:s.memberSince||(new Date).getFullYear()},localStorage.setItem("profile",JSON.stringify(w)),window.location.href="admin"===l?"frsadm.html":"Home.html"}catch(e){console.error("LOGIN ERROR:",e.code,e.message);let t="Gagal login. Cek lagi email dan password ya ðŸ™‚";"auth/user-not-found"===e.code?t="Email belum terdaftar. Silakan Sign Up dulu ya ðŸ™‚":"auth/wrong-password"===e.code?t="Password salah. Coba lagi ya ðŸ˜Š":"auth/invalid-email"===e.code&&(t="Format email tidak valid."),alert(t)}else alert("Isi email dan password dulu ya ðŸ™‚")}));