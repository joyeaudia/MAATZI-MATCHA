// @ts-nocheck
!function(){"use strict";function e(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}function t(e){try{localStorage.setItem("orders",JSON.stringify(e||[]))}catch(e){console.error("Failed to save orders",e)}}function n(e){return String(e||"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])))}function i(){return e("orders")}function a(e,t){let n;try{n=JSON.parse(localStorage.getItem("notifications_v1")||"[]")}catch(e){n=[]}const i=new Date;let a="",d="",s="";"approved"===t?(a="Payment Confirmed",s="üí∏",d="Order "+(e.id||"")+" telah dikonfirmasi dan pembayaran sudah diterima admin."):"rejected"===t&&(a="Order Rejected",s="‚õî",d="Order "+(e.id||"")+" telah ditolak / dibatalkan oleh admin.");const r={id:"adm-"+t+"-"+(e.id||"")+"-"+i.getTime(),title:a,message:d,emoji:s,time:"Just now",isRead:!1};n.unshift(r);try{localStorage.setItem("notifications_v1",JSON.stringify(n))}catch(e){console.error("Failed to save notifications",e)}}function d(){const s=document.getElementById("admin-content");if(!s)return;s.innerHTML="";let r=i()||[];r=r.filter((e=>"cancelled"!==String(e.status||"").toLowerCase())),r.length?r.forEach((r=>{s.appendChild(function(s){const r=document.createElement("article");r.className="admin-order-card";const o=new Date(s.createdAt||Date.now()).toLocaleString(),c=(s.status||"active").toLowerCase(),l=(s.paymentStatus||"pending").toLowerCase(),m=s.meta&&"string"==typeof s.meta.recipient?s.meta.recipient.trim():"",v=e("savedAddresses_v1");let g=null;Array.isArray(v)&&v.length&&(g=v.find((e=>e&&e.isDefault))||v[0]);let u="";if(m){u=`\n        <div class="admin-address">\n          <div class="admin-address-title">Recipient</div>\n          <div class="admin-address-main">\n            <div>${n(m).replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}else if(g){const e=n(g.label||""),t=n(g.name||""),i=n(g.phone||"");u=`\n        <div class="admin-address">\n          <div class="admin-address-title">Address</div>\n          <div class="admin-address-main">\n            <div>${`${e||""}${e&&t?" - ":""}${t||""}`}</div>\n            ${i?`<div>${i}</div>`:""}\n            <div>${n(g.address||"").replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}const f=s.items&&s.items[0],p=Math.max(0,(s.items||[]).length-1),$=f?n(f.title):"No title",b=!!s.isGift&&!!s.gift;let h="";if(b){const e="surprise"===String(s.gift.revealMode||"reveal")?"Keep it a surprise":"Reveal it now";let t="";if(s.scheduledAt)try{t=new Date(s.scheduledAt).toLocaleString("id-ID")}catch(e){}const i=s.meta&&s.meta.recipient?n(s.meta.recipient):"";h=`\n        <div class="admin-gift-block">\n          <div class="admin-gift-title">üéÅ Gift order</div>\n          ${s.gift.message?`<div class="admin-gift-line"><strong>Message:</strong> ${n(s.gift.message)}</div>`:""}\n          ${s.gift.fromName?`<div class="admin-gift-line"><strong>From:</strong> ${n(s.gift.fromName)}</div>`:""}\n          <div class="admin-gift-line"><strong>Reveal:</strong> ${n(e)}</div>\n          ${t?`<div class="admin-gift-line"><strong>Schedule:</strong> ${n(t)}</div>`:""}\n          ${i?`<div class="admin-gift-line"><strong>Recipient:</strong> ${i}</div>`:""}\n        </div>\n      `}const y="paid"===l?"badge-payment paid":"rejected"===l?"badge-payment rejected":"badge-payment";r.innerHTML=`\n      <div class="admin-order-header">\n        <div class="admin-order-id">Order ID: ${n(s.id||"(no id)")}</div>\n        <div class="admin-order-created">${n(o)}</div>\n      </div>\n\n      <div class="admin-status-row">\n        <span class="badge badge-status">Status: ${n(c)}</span>\n        <span class="badge ${y}">Payment: ${n(l)}</span>\n        <span class="badge">Total: ${S=s.total,"Rp "+new Intl.NumberFormat("id-ID").format(Number(S||0))}</span>\n      </div>\n\n      ${h}\n\n      <div class="admin-items">\n        <div>${$}${p>0?" +"+p+" more":""}</div>\n      </div>\n\n      ${u}\n\n      <div class="admin-actions">\n        <button class="btn btn-approve" data-id="${n(s.id)}">ACC (sudah dibayar)</button>\n        <button class="btn btn-reject" data-id="${n(s.id)}">Tolak order</button>\n      </div>\n    `;var S;const I=r.querySelector(".btn-approve"),L=r.querySelector(".btn-reject");"paid"===l?(I&&(I.style.display="none"),L&&(L.style.display="none")):(I&&I.addEventListener("click",(function(){const e=this.dataset.id,n=i(),s=n.findIndex((t=>String(t.id)===String(e)));-1!==s&&(n[s].paymentStatus="paid",n[s].status||(n[s].status="active"),a(n[s],"approved"),t(n),d(),alert("Order di-set sebagai SUDAH DIBAYAR."))})),L&&L.addEventListener("click",(function(){const e=this.dataset.id,n=i(),s=n.findIndex((t=>String(t.id)===String(e)));-1!==s&&(n[s].paymentStatus="rejected",n[s].status="cancelled",a(n[s],"rejected"),t(n),d(),alert("Order telah DITOLAK / dibatalkan oleh admin."))})));return r.addEventListener("click",(function(e){if(e.target.closest(".admin-actions"))return;if("paid"!==l)return;const t=s.id||"";t&&(window.location.href="diteladm.html?id="+encodeURIComponent(t))})),r}(r))})):s.innerHTML='<div style="color:#777;font-size:13px;">Belum ada order.</div>'}document.addEventListener("DOMContentLoaded",d)}();