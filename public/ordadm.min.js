// @ts-nocheck
!function(){"use strict";function e(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}function t(e){try{localStorage.setItem("orders",JSON.stringify(e||[]))}catch(e){console.error("Failed to save orders",e)}}function n(e){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(e||0))}function i(e){return String(e||"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])))}function a(){return e("orders")}function d(e,t){let n;try{n=JSON.parse(localStorage.getItem("notifications_v1")||"[]")}catch(e){n=[]}const i=new Date;let a="",d="",s="";"approved"===t?(a="Payment Confirmed",s="üí∏",d="Order "+(e.id||"")+" telah dikonfirmasi dan pembayaran sudah diterima admin."):"rejected"===t&&(a="Order Rejected",s="‚õî",d="Order "+(e.id||"")+" telah ditolak / dibatalkan oleh admin.");const r={id:"adm-"+t+"-"+(e.id||"")+"-"+i.getTime(),title:a,message:d,emoji:s,time:"Just now",isRead:!1};n.unshift(r);try{localStorage.setItem("notifications_v1",JSON.stringify(n))}catch(e){console.error("Failed to save notifications",e)}}function s(){const r=document.getElementById("admin-content");if(!r)return;r.innerHTML="";let o=a()||[];o=o.filter((e=>"cancelled"!==String(e.status||"").toLowerCase())),o.length?o.forEach((o=>{r.appendChild(function(r){const o=document.createElement("article");o.className="admin-order-card";const c=new Date(r.createdAt||Date.now()).toLocaleString(),l=(r.status||"active").toLowerCase(),m=(r.paymentStatus||"pending").toLowerCase(),v=r.meta&&"string"==typeof r.meta.recipient?r.meta.recipient.trim():"",g=e("savedAddresses_v1");let u=null;Array.isArray(g)&&g.length&&(u=g.find((e=>e&&e.isDefault))||g[0]);let f="";if(v){f=`\n        <div class="admin-address">\n          <div class="admin-address-title">Recipient</div>\n          <div class="admin-address-main">\n            <div>${i(v).replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}else if(u){const e=i(u.label||""),t=i(u.name||""),n=i(u.phone||"");f=`\n        <div class="admin-address">\n          <div class="admin-address-title">Address</div>\n          <div class="admin-address-main">\n            <div>${`${e||""}${e&&t?" - ":""}${t||""}`}</div>\n            ${n?`<div>${n}</div>`:""}\n            <div>${i(u.address||"").replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}const p=!!r.isGift&&!!r.gift;let b="";if(p){const e="surprise"===String(r.gift.revealMode||"reveal")?"Keep it a surprise":"Reveal it now";let t="";if(r.scheduledAt)try{t=new Date(r.scheduledAt).toLocaleString("id-ID")}catch(e){}const n=r.meta&&r.meta.recipient?i(r.meta.recipient):"";b=`\n        <div class="admin-gift-block">\n          <div class="admin-gift-title">üéÅ Gift order</div>\n          ${r.gift.message?`<div class="admin-gift-line"><strong>Message:</strong> ${i(r.gift.message)}</div>`:""}\n          ${r.gift.fromName?`<div class="admin-gift-line"><strong>From:</strong> ${i(r.gift.fromName)}</div>`:""}\n          <div class="admin-gift-line"><strong>Reveal:</strong> ${i(e)}</div>\n          ${t?`<div class="admin-gift-line"><strong>Schedule:</strong> ${i(t)}</div>`:""}\n          ${n?`<div class="admin-gift-line"><strong>Recipient:</strong> ${n}</div>`:""}\n        </div>\n      `}let $="";(r.items||[]).forEach((e=>{if(!e)return;const t=i(e.title||""),a=e.addons&&e.addons.length?'<div class="admin-item-addons">'+e.addons.map((e=>i(e.label||""))).join(", ")+"</div>":"",d=Number(e.qty||0),s=Number(e.unitPrice||e.price||0),r=Number(e.subtotal||s*d),o=d+" √ó "+n(s)+" = "+n(r);$+=`\n        <div class="admin-item-row">\n          <div class="admin-item-main">\n            <div class="admin-item-title">${t}</div>\n            ${a}\n            <div class="admin-item-price">${i(o)}</div>\n          </div>\n        </div>\n      `}));const y="paid"===m?"badge-payment paid":"rejected"===m?"badge-payment rejected":"badge-payment";o.innerHTML=`\n      <div class="admin-order-header">\n        <div class="admin-order-id">Order ID: ${i(r.id||"(no id)")}</div>\n        <div class="admin-order-created">${i(c)}</div>\n      </div>\n\n      <div class="admin-status-row">\n        <span class="badge badge-status">Status: ${i(l)}</span>\n        <span class="badge ${y}">Payment: ${i(m)}</span>\n        <span class="badge">Total: ${n(r.total)}</span>\n      </div>\n\n      ${b}\n\n      <div class="admin-items">\n        ${$}\n      </div>\n\n      ${f}\n\n      <div class="admin-actions">\n        <button class="btn btn-approve" data-id="${i(r.id)}">ACC (sudah dibayar)</button>\n        <button class="btn btn-reject" data-id="${i(r.id)}">Tolak order</button>\n      </div>\n    `;const h=o.querySelector(".btn-approve"),S=o.querySelector(".btn-reject");"paid"===m?(h&&(h.style.display="none"),S&&(S.style.display="none")):(h&&h.addEventListener("click",(function(){const e=this.dataset.id,n=a(),i=n.findIndex((t=>String(t.id)===String(e)));-1!==i&&(n[i].paymentStatus="paid",n[i].status||(n[i].status="active"),d(n[i],"approved"),t(n),s(),alert("Order di-set sebagai SUDAH DIBAYAR."))})),S&&S.addEventListener("click",(function(){const e=this.dataset.id,n=a(),i=n.findIndex((t=>String(t.id)===String(e)));-1!==i&&(n[i].paymentStatus="rejected",n[i].status="cancelled",d(n[i],"rejected"),t(n),s(),alert("Order telah DITOLAK / dibatalkan oleh admin."))})));return o.addEventListener("click",(function(e){if(e.target.closest(".admin-actions"))return;if("paid"!==m)return;const t=r.id||"";t&&(window.location.href="diteladm.html?id="+encodeURIComponent(t))})),o}(o))})):r.innerHTML='<div style="color:#777;font-size:13px;">Belum ada order.</div>'}document.addEventListener("DOMContentLoaded",s)}();