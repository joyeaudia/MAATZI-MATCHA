// @ts-nocheck
const recentGrid=document.getElementById("recent-grid"),resultsGrid=document.getElementById("results"),q=document.getElementById("q"),clearBtn=document.getElementById("clear-recent"),JSON_PATHS=["drsi.json","dsri.json"];let catalog=[];const RECENT_KEY="recently_viewed_v1",MAX_RECENT=8;async function loadCatalog(){const e=JSON_PATHS.map((e=>fetch(e).then((e=>e.json())).catch((t=>(console.error("Gagal load",e,t),[]))))),t=await Promise.all(e);catalog=t.flat(),catalog=catalog.map((e=>({id:e.id||"",title:e.title||"",price:e.price||0,images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],...e})))}function getRecent(){try{const e=localStorage.getItem(RECENT_KEY);return e?JSON.parse(e):[]}catch(e){return[]}}function setRecent(e){localStorage.setItem(RECENT_KEY,JSON.stringify(e.slice(0,8)))}function renderRecent(){const e=getRecent();if(recentGrid.innerHTML="",0!==e.length)e.forEach((e=>{const t=document.createElement("div");t.className="recent-card";const n=document.createElement("img");n.src=e.images&&e.images.length?e.images[0]:"assets/placeholder.png",n.alt=e.title;const c=document.createElement("div");c.className="price-tag",c.textContent=formatRp(e.price),t.appendChild(n),t.appendChild(c),t.addEventListener("click",(()=>{alert("Open: "+e.title),pushToRecent(e),renderRecent()})),recentGrid.appendChild(t)}));else for(let e=0;e<4;e++){const e=document.createElement("div");e.className="recent-card",recentGrid.appendChild(e)}}function formatRp(e){return"Rp "+(Number(e)||0).toLocaleString("id-ID")}function pushToRecent(e){const t=getRecent().filter((t=>t.id!==e.id));t.unshift({id:e.id,title:e.title,price:e.price,images:e.images}),setRecent(t)}function renderResults(e){resultsGrid.innerHTML="",e&&0!==e.length?e.forEach((e=>{const t=document.createElement("div");t.className="result-card";const n=document.createElement("img");n.src=e.images&&e.images.length?e.images[0]:"assets/placeholder.png",n.alt=e.title;const c=document.createElement("div");c.className="meta";const r=document.createElement("div");r.className="result-title",r.textContent=e.title;const i=document.createElement("div");i.className="result-price",i.textContent=formatRp(e.price),c.appendChild(r),c.appendChild(i),t.appendChild(n),t.appendChild(c),t.addEventListener("click",(()=>{alert("Open product: "+e.title),pushToRecent(e),renderRecent()})),resultsGrid.appendChild(t)})):resultsGrid.innerHTML='<div style="color:#8b8b92;padding:8px">No results</div>'}function performSearch(e){const t=(e||"").trim().toLowerCase();if(!t)return renderResults([]),[];const n=catalog.filter((e=>e.title.toLowerCase().includes(t)));if(n.length){const e=n.map((e=>({id:e.id,title:e.title,price:e.price,images:e.images}))),t=getRecent().filter((t=>!e.find((e=>e.id===t.id))));setRecent([...e,...t].slice(0,8)),renderRecent()}return renderResults(n),n}q.addEventListener("keyup",(e=>{const t=e.target.value;"Enter"===e.key?performSearch(t):debounceLive(t)}));let _debounceTimer=null;function debounceLive(e){clearTimeout(_debounceTimer),_debounceTimer=setTimeout((()=>performSearch(e)),300)}clearBtn.addEventListener("click",(()=>{localStorage.removeItem(RECENT_KEY),renderRecent()})),async function(){await loadCatalog(),renderRecent()}();