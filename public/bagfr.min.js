// @ts-nocheck
!function(){"use strict";function t(t){return"Rp "+(t=Math.round(Number(t)||0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function e(t){return String(t||"").replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])))}function i(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(t){return[]}}function r(t){localStorage.setItem("cart",JSON.stringify(t||[]))}function n(){const r=i(),n=document.getElementById("bag-items")||document.querySelector(".cart-list")||document.querySelector(".bag-items");if(!n)return;if(n.innerHTML="",!r.length)return n.innerHTML='<p class="empty" style="text-align:center;color:#666;padding:18px 0">Keranjang kosong.</p>',void s();let a=0;r.forEach(((i,r)=>{const s=Number(i.unitPrice||i.price||0),d=Number(i.qty||1),l=Number(i.subtotal||s*d||0);a+=l;const o=i.addons&&i.addons.length?i.addons.map((i=>{const r=String(i.label||"").trim(),n=/\(\s*\+\s*\d+|Rp\b|K\)/i.test(r),s=e(r);return n?`<div class="addon">${s}</div>`:`<div class="addon">${s}${i.price?` (+${t(i.price)})`:""}</div>`})).join(""):"",c=`\n        <article class="cart-item" data-idx="${r}" data-price="${s}">\n          <div class="thumb"><img src="${e(i.image||i.images&&i.images[0]||"assets/placeholder.png")}" alt="${e(i.title||"Product")}" onerror="this.onerror=null;this.src='assets/placeholder.png'"></div>\n          <div class="item-body">\n            <div class="item-head">\n              <div>\n                <div class="item-title">${e(i.title||"Untitled")}</div>\n                <div class="item-meta">${o}</div>\n              </div>\n              <button class="remove" title="Hapus item" aria-label="Hapus item" data-idx="${r}">\n                <img src="acs/smph.png" alt="Hapus">\n              </button>\n            </div>\n\n            <div class="item-controls">\n              <div class="qty-control">\n                <button class="qty-btn qty-decr" aria-label="Kurangi">-</button>\n                <span class="qty">${d}</span>\n                <button class="qty-btn qty-incr" aria-label="Tambah">+</button>\n              </div>\n\n              <div class="right-col">\n                <div class="item-sub-value">${t(l)}</div>\n              </div>\n            </div>\n          </div>\n        </article>\n      `,u=document.createElement("div");u.innerHTML=c.trim(),n.appendChild(u.firstElementChild)})),s(a)}function s(e){let r=Number(e||0);if(!e){r=i().reduce(((t,e)=>t+(Number(e.subtotal)||Number(e.unitPrice||e.price||0)*Number(e.qty||1))),0)}const n=document.querySelector(".summary-value")||document.getElementById("bag-total")||document.querySelector(".bag-total");n&&(n.textContent=t(r))}function a(){try{return JSON.parse(localStorage.getItem("likes")||"[]")}catch(t){return[]}}function d(){const t=a(),i=document.querySelector(".liked-row")||document.getElementById("liked-row");i&&(i.innerHTML="",t.length?t.forEach((t=>{const r=String(t.id||""),n=String(t.title||""),s=String(t.image||"assets/placeholder.png"),a=Number(t.price||0),d=a?"Rp "+new Intl.NumberFormat("id-ID").format(a):"",l=document.createElement("article");l.className="like-card",l.setAttribute("role","listitem"),l.setAttribute("data-id",r),l.setAttribute("data-source",t.source||(r.includes("dsri-")?"dsri":r.includes("drsi-")?"drsi":"")),l.innerHTML=`\n        <div class="like-thumb"><img src="${e(s)}" alt="${e(n)}" onerror="this.onerror=null;this.src='assets/placeholder.png'"></div>\n\n        <div class="like-body">\n          <div class="like-title">${e(n)}</div>\n        </div>\n\n        <div class="like-footer">\n          ${d?`<div class="like-price footer-price">${e(d)}</div>`:""}\n          <button class="like-heart" aria-label="Unlike" title="Unlike" data-id="${e(r)}" aria-pressed="false">‚ù§</button>\n        </div>\n      `,i.appendChild(l)})):i.innerHTML='<div style="color:#888;padding:12px">You have no liked items yet.</div>')}document.addEventListener("click",(function(t){const e=t.target.closest(".cart-item");if(!e)return;const s=Number(e.dataset.idx);let a=i();return t.target.closest(".qty-incr")?(a[s].qty=Number(a[s].qty||1)+1,a[s].subtotal=Number(a[s].unitPrice||a[s].price||0)*a[s].qty,r(a),void n()):t.target.closest(".qty-decr")?(a[s].qty=Math.max(1,Number(a[s].qty||1)-1),a[s].subtotal=Number(a[s].unitPrice||a[s].price||0)*a[s].qty,r(a),void n()):t.target.closest(".remove")?(a.splice(s,1),r(a),void n()):void 0})),window.addToBag=function(t){if(!t||!t.id)throw new Error("productObj.id required");const e=i(),s=e.findIndex((e=>e.id===t.id&&JSON.stringify(e.addons||[])===JSON.stringify(t.addons||[])));if(s>=0)e[s].qty=Number(e[s].qty||1)+(Number(t.qty)||1),e[s].subtotal=Number(e[s].unitPrice||e[s].price||0)*e[s].qty;else{const i=Number(t.qty||1),r=Number(t.unitPrice||t.price||0),n={id:t.id,title:t.title||"",unitPrice:r,qty:i,subtotal:Number(t.subtotal||r*i),image:t.image||t.images&&t.images[0]||"assets/placeholder.png",addons:t.addons||[],source:t.source||""};e.push(n)}r(e),n()},window.renderCart=n,document.addEventListener("click",(function(t){const e=t.target.closest(".like-heart");if(e){e.setAttribute("aria-pressed","true"),e.classList.add("like-heart-pressed");const i=e.dataset.id;return i?setTimeout((()=>{let t=a();var e;t=t.filter((t=>String(t.id)!==String(i))),e=t,localStorage.setItem("likes",JSON.stringify(e||[])),d(),window.dispatchEvent(new CustomEvent("likes:updated",{detail:{likes:t}}))}),180):setTimeout(d,180),void t.stopPropagation()}const i=t.target.closest(".like-card");if(i){let t=i.getAttribute("data-id")||i.dataset.id||null;const e=(i.getAttribute("data-source")||i.dataset.source||"").toLowerCase()||null;if(!t)try{const e=JSON.parse(localStorage.getItem("likes")||"[]"),r=i.querySelector(".like-title")?.textContent?.trim(),n=i.querySelector(".like-thumb img")?.src,s=e.find((t=>t.title&&t.title===r||t.image&&t.image===n));s&&s.id&&(t=s.id)}catch(t){}if(!t)return void alert("Tidak dapat menemukan id produk untuk kartu ini.");let r="./drsi.html";"dsri"===e?r="./dsri.html":"bsri"===e?r="./bsri.html":t.startsWith("dsri-")?r="./dsri.html":t.startsWith("drsi-")&&(r="./drsi.html"),window.location.assign(`${r}?id=${encodeURIComponent(String(t))}`)}})),document.addEventListener("DOMContentLoaded",(function(){n(),d()})),window.addEventListener("likes:updated",d)}();