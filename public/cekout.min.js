// @ts-nocheck
document.addEventListener("DOMContentLoaded",(function(){"use strict";const e=e=>{const t=Math.round(Number(e)||0),n=Math.abs(t).toString(),a=[];for(let e=n.length-1,t=0;e>=0;e--,t++)a.push(n[e]),t%3==2&&0!==e&&a.push(".");return(t<0?"-":"")+"Rp "+a.reverse().join("")+",00"};function t(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}function n(e,t){localStorage.setItem(e,JSON.stringify(t||[]))}function a(){return t("cart")}function r(e){return String(e||"").replace(/[&<>"']/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]}))}const i=document.querySelector(".product-list"),c=document.getElementById("subtotalRp"),o=document.getElementById("shippingFee"),u=document.getElementById("totalRp"),l=Array.from(document.querySelectorAll(".delivery-item"));document.getElementById("deliveryRow");if(!(i&&c&&o&&u))return void console.warn("cekout: required elements not found");function s(){const t=a();if(i.innerHTML="",!t||!t.length){const e=document.createElement("li");return e.className="product-item",e.innerHTML='<div class="product-info"><div class="product-title">Keranjang kosong</div><div class="product-meta muted">Tambahkan produk dari keranjang</div></div>',i.appendChild(e),void m()}t.forEach(((t,n)=>{const a=Number(t.unitPrice||t.price||0),c=Math.max(0,Number(t.qty||1)),o=(Number(t.subtotal||a*c||a*c),document.createElement("li"));o.className="product-item",o.dataset.cartIdx=n;const u=t.source?`${t.source} • `:"",l=e(a);o.innerHTML=`\n        <div class="product-info">\n          <div class="product-title">${r(t.title||"Untitled")}</div>\n          <div class="product-meta">${r(u)}${l}</div>\n        </div>\n        <div class="qty-control" data-price="${a}">\n          <button class="qty-btn dec" aria-label="Decrease">−</button>\n          <input class="qty-input" type="text" inputmode="numeric" value="${c}" aria-label="Quantity">\n          <button class="qty-btn inc" aria-label="Increase">+</button>\n        </div>\n      `,i.appendChild(o);const s=o.querySelector(".dec"),m=o.querySelector(".inc"),p=o.querySelector(".qty-input");s.addEventListener("click",(()=>{let e=Number(p.value)||0;e=Math.max(0,e-1),p.value=String(e),d(n,e)})),m.addEventListener("click",(()=>{let e=Number(p.value)||0;e+=1,p.value=String(e),d(n,e)})),p.addEventListener("input",(()=>{p.value=p.value.replace(/[^\d]/g,""),""===p.value&&(p.value="0");const e=Number(p.value);d(n,e)}))}))}function d(e,t){const r=a();r&&r[e]?(r[e].qty=Number(t||0),r[e].subtotal=Number(Number(r[e].unitPrice||r[e].price||0)*Number(r[e].qty||0)),r[e].qty<=0&&r.splice(e,1),function(e){n("cart",e)}(r),s(),m()):m()}function m(){const t=a();let n=0,r=0;Array.isArray(t)&&t.forEach((e=>{const t=Number(e.unitPrice||e.price||0),a=Math.max(0,Number(e.qty||0));r+=t*a,n+=a}));let i=15e3;switch(document.querySelector(".delivery-item.active")?.dataset.method||"regular"){case"regular":default:i=15e3;break;case"nextday":i=2e4;break;case"sameday":i=3e4;break;case"instant":i=5e4;break;case"self":i=5e3}const l=i*(n>0?Math.max(1,Math.ceil(n/5)):1),s=r+l;c&&(c.textContent=e(r)),o&&(o.textContent=e(l)),u&&(u.textContent=e(s))}l.forEach((e=>{e.addEventListener("click",(()=>{l.forEach((e=>{e.classList.remove("active"),e.setAttribute("aria-pressed","false")})),e.classList.add("active"),e.setAttribute("aria-pressed","true"),"function"==typeof e.scrollIntoView&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"}),m()}))}));const p=document.getElementById("placeOrder");p&&p.addEventListener("click",(function(){const e=a();if(!e||!e.length)return void alert("Keranjang kosong — tidak ada yang dipesan.");let r=null;try{const e=document.querySelector('select[aria-label="Date"]'),t=document.querySelector('select[aria-label="Month"]'),n=document.querySelector('select[aria-label="Year"]'),a=e?.value||"",i=t?.value||"",c=n?.value||"",o=Number(a),u=Number(c);if(!isNaN(o)&&!isNaN(u)&&i){const e={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12};let t=Number(i);if(isNaN(t)){t=e[String(i).trim().slice(0,3).toLowerCase()]||NaN}if(!isNaN(t)){const e=new Date(u,t-1,o,9,0,0);isNaN(e.getTime())||(r=e.toISOString())}}}catch(e){}const i=document.getElementById("notes")?.value?.trim()||"",c=document.getElementById("recipient")?.value?.trim()||"";let o=0;e.forEach((e=>{o+=Number(e.subtotal||Number(e.unitPrice||e.price||0)*Number(e.qty||0)||0)}));const u=document.querySelector(".delivery-item.active")?.dataset.method||"regular";let l=15e3;switch(u){case"regular":default:l=15e3;break;case"nextday":l=2e4;break;case"sameday":l=3e4;break;case"instant":l=5e4;break;case"self":l=5e3}const s=e.reduce(((e,t)=>e+Number(t.qty||0)),0),d=l*Math.max(1,Math.ceil(s/5)),m=Number(o)+Number(d),p={id:"ORD-"+(new Date).toISOString().slice(0,10)+"-"+Math.random().toString(36).slice(2,6).toUpperCase(),createdAt:Date.now(),status:"scheduled",scheduledAt:r,total:m,shippingFee:d,items:e.map((e=>({id:e.id,title:e.title,qty:Number(e.qty||1),unitPrice:Number(e.unitPrice||e.price||0),subtotal:Number(e.subtotal||Number(e.unitPrice||e.price||0)*Number(e.qty||1)),addons:e.addons||[],image:e.image||e.images&&e.images[0]||""}))),meta:{notes:i,recipient:c,deliveryMethod:u}},b=t("orders");b.unshift(p),n("orders",b);try{localStorage.removeItem("cart")}catch(e){}window.location.href="./order.html?order="+encodeURIComponent(p.id)})),function({yearsAhead:e=5}={}){const t=document.querySelector('select[aria-label="Date"]'),n=document.querySelector('select[aria-label="Month"]'),a=document.querySelector('select[aria-label="Year"]');if(!t||!n||!a)return;function r(e,t){const n=document.createElement("option");return n.value=String(e),n.textContent=String(t),n}t.innerHTML="",n.innerHTML="",a.innerHTML="",n.appendChild(r("","Month")),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].forEach(((e,t)=>n.appendChild(r(t+1,e))));const i=new Date,c=i.getFullYear();a.appendChild(r("","Year"));for(let t=c;t<=c+(Number(e)||5);t++)a.appendChild(r(t,t));function o(){const e=Number(n.value)||i.getMonth()+1,o=Number(a.value)||c,u=function(e,t){return new Date(e,t+1,0).getDate()}(o,e-1),l=Number(t.value)||i.getDate();t.innerHTML="",t.appendChild(r("","Date"));for(let e=1;e<=u;e++)t.appendChild(r(e,e));l>=1&&l<=u?t.value=String(l):o===c&&e===i.getMonth()+1?t.value=String(i.getDate()):t.value="1"}n.value=String(i.getMonth()+1),a.value=String(c),o(),n.addEventListener("change",o),a.addEventListener("change",o)}({yearsAhead:5}),s(),m()}));