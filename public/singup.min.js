// @ts-nocheck
import{auth,db}from"./firebase-config.js";import{createUserWithEmailAndPassword,updateProfile}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";import{doc,setDoc,serverTimestamp}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";function setupCustomAlert(){const e=document.getElementById("alertModal"),t=document.getElementById("alertText"),a=document.getElementById("alertClose");function o(){e&&(e.style.display="none")}return a&&a.addEventListener("click",o),e&&e.addEventListener("click",(t=>{t.target===e&&o()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&o()})),function(a){e&&t?(t.textContent=a,e.style.display="flex"):window.alert(a)}}const showAlert=setupCustomAlert();document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#fullname, #name, #nama")||document.querySelector("input[name='fullname'], input[name='name']"),t=document.querySelector("#email")||document.querySelector("input[type='email']"),a=document.querySelector("#phone, #telp, #nohp")||document.querySelector("input[type='tel']"),o=document.querySelector("#password")||document.querySelector("input[type='password']"),n=document.querySelector("#confirm-password, #password2, #confirmpassword"),r=document.querySelector("#createAccountBtn, #create-account-btn, #signupBtn, #signUpBtn, .create-btn, .signup-btn")||document.querySelector("button[type='submit']");console.log("cek elemen signup:",{nameEl:e,emailEl:t,phoneEl:a,passEl:o,confirmEl:n,submitBtn:r}),r?(document.querySelectorAll(".toggle").forEach((e=>{e.addEventListener("click",(()=>{const t=e.previousElementSibling;if(!t)return;const a="password"===t.type;t.type=a?"text":"password",e.textContent=a?"ðŸ™ˆ":"ðŸ‘ï¸"}))})),r.addEventListener("click",(async()=>{const r=(e?.value||"").trim(),s=(t?.value||"").trim(),l=(a?.value||"").trim(),i=o?.value||"",c=n?.value||"";if(r&&s&&l&&i&&c)if(function(e){return/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\d/.test(e)&&/[^A-Za-z0-9]/.test(e)&&e.length>=8}(i))if(i===c)try{const e=(await createUserWithEmailAndPassword(auth,s,i)).user;await updateProfile(e,{displayName:r});const t="byverent@gmail.com",a=s.toLowerCase()===t.toLowerCase()?"admin":"user";await setDoc(doc(db,"users",e.uid),{name:r,email:s,phone:l,role:a,memberSince:(new Date).getFullYear(),createdAt:serverTimestamp()}),localStorage.setItem("maziRole",a),localStorage.setItem("maziEmail",s),localStorage.setItem("maziName",r),localStorage.setItem("maziPhone",l);const o=r.split(/\s+/),n=o[0]||"",c={firstName:n,lastName:o.slice(1).join(" "),email:s,phone:l,memberSince:(new Date).getFullYear()};localStorage.setItem("profile",JSON.stringify(c)),showAlert("Akun berhasil dibuat! ðŸŽ‰");const m=document.getElementById("alertModal"),d=document.getElementById("alertClose");if(d&&m){const e=()=>{m.style.display="none",d.removeEventListener("click",e),window.location.href="alamat.html?from=signup"};d.addEventListener("click",e)}else window.location.href="alamat.html?from=signup"}catch(e){console.error("Error Firebase:",e);let t="Terjadi kesalahan saat mendaftar.";"auth/email-already-in-use"===e.code?t="Email ini sudah terdaftar. Silakan Sign In saja ya ðŸ™‚":"auth/invalid-email"===e.code?t="Format email tidak valid.":"auth/weak-password"===e.code&&(t="Password terlalu lemah."),showAlert(t)}else showAlert("Password dan konfirmasinya tidak sama.");else showAlert("Password harus minimal 8 karakter, ada huruf besar, huruf kecil, angka, dan simbol.");else showAlert("Semua kolom wajib diisi ya ðŸ™‚")}))):console.error("Tombol signup tidak ditemukan. Coba kasih id='createAccountBtn' atau class='create-btn' di HTML.")}));