// @ts-nocheck
!async function(){"use strict";const t=t=>document.querySelector(t),e=t=>"Rp "+new Intl.NumberFormat("id-ID").format(Number(t)||0),r=t=>Number(String(t||"").replace(/[^\d]/g,""))||0;try{const r=new URLSearchParams(location.search).get("id");if(r){const o=(await async function(){const t=["drsi.json","dsri.json","products.json","/drsi.json","/products.json","/dsri.json"];for(const e of t)try{const t=await fetch(e,{cache:"no-store"});if(!t.ok)continue;const r=await t.json();if(Array.isArray(r))return r}catch(t){}throw new Error("products file not found (tried drsi.json/products.json)")}()).find((t=>t.id===r));if(o){const r=t(".product-name"),n=t(".product-subtitle"),a=t("#product-price"),i=t(".product-image"),c=t("#detail-desc");r&&(r.textContent=o.title||"",r.dataset.id=o.id),n&&(n.textContent=o.subtitle||""),a&&(a.dataset.base=o.price||0,a.textContent=e(o.price||0),a.setAttribute("aria-live","polite"),window.productBasePrice=Number(o.price||0)),i&&(i.tagName&&"img"===i.tagName.toLowerCase()?(i.src=o.images&&o.images[0]||"",i.alt=o.title||""):i.innerHTML=`<img src="${o.images&&o.images[0]||""}" alt="${o.title||""}" />`),c&&(Array.isArray(o.description)?c.innerHTML=o.description.join("<br><br>"):c.innerHTML=o.description||""),"function"==typeof window.initOptionButtons&&window.initOptionButtons(),"function"==typeof window.updatePriceFromUI&&window.updatePriceFromUI()}else console.error("Product not found for id:",r)}else console.error("No product id in URL (use ?id=product-id)")}catch(t){console.error("Error loading product:",t)}!function(){const o=t("#product-price"),n=r(o?.dataset.base||window.productBasePrice||0);function a(t){const e=t.dataset.price??t.dataset.priceDelta??t.getAttribute("data-price-delta");return r(e)}function i(){let t=n;const r=document.querySelector('.option-group[data-key="milk"] button[aria-pressed="true"]');r&&(t+=a(r)),document.querySelectorAll('.option-group[data-key="addons"] button[aria-pressed="true"]').forEach((e=>{t+=a(e)})),o&&(o.textContent=e(t));const i=document.getElementById("price-display");i&&(i.textContent=e(t))}document.querySelectorAll(".option-group").forEach((t=>{const e=Array.from(t.querySelectorAll("button")),r="addons"===t.dataset.key;e.forEach((t=>{t.hasAttribute("aria-pressed")||t.setAttribute("aria-pressed","false"),t.addEventListener("click",(()=>{if(r){const e="true"===t.getAttribute("aria-pressed");t.setAttribute("aria-pressed",(!e).toString())}else e.forEach((t=>t.setAttribute("aria-pressed","false"))),t.setAttribute("aria-pressed","true");i()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key&&"Spacebar"!==e.key||(e.preventDefault(),t.click())}))}))})),window.updatePriceFromUI=i,window.initOptionButtons=function(){},setTimeout(i,40)}()}(),function(){const t=document.querySelector(".heart");if(!t)return;const e=t=>localStorage.setItem("likes",JSON.stringify(t||[]));function r(t){let e=document.querySelector(".mini-toast");e||(e=document.createElement("div"),e.className="mini-toast",Object.assign(e.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",bottom:"28px",background:"#111",color:"#fff",padding:"8px 12px",borderRadius:"8px",zIndex:1600,opacity:0,transition:"opacity .18s"}),document.body.appendChild(e)),e.textContent=t,e.style.opacity="1",setTimeout((()=>e.style.opacity="0"),1300)}t.addEventListener("click",(function(o){const n="true"===t.getAttribute("aria-pressed");t.setAttribute("aria-pressed",String(!n));try{t.animate([{transform:"scale(1)"},{transform:"scale(1.12)"},{transform:"scale(1)"}],{duration:220})}catch(o){}const a=(()=>{try{return JSON.parse(localStorage.getItem("likes")||"[]")}catch(t){return[]}})(),i=function(){const t=document.querySelector(".product-name")?.dataset?.id||new URLSearchParams(location.search).get("id")||"",e=document.querySelector(".product-name")?.textContent?.trim()||document.title||"",r=document.querySelector(".product-image")||document.querySelector(".product-image img");return{id:t,title:e,image:r&&r.tagName&&"img"===r.tagName.toLowerCase()?r.src:r&&r.querySelector&&r.querySelector("img")?.src||"",price:Number(document.getElementById("product-price")?.dataset?.base||0)}}();if(!i.id)return void r("Tidak dapat menyukai item ini");const c=a.findIndex((t=>t.id===i.id));n?(c>-1&&a.splice(c,1),e(a),r("Dihapus dari Liked")):(-1===c&&a.unshift(i),e(a),r("Ditambahkan ke Liked")),window.dispatchEvent(new CustomEvent("likes:updated",{detail:{likes:a}}))}))}(),function(){const t=document.getElementById("share-btn"),e=document.getElementById("share-menu"),r=document.getElementById("share-toast"),o=document.getElementById("share-close");if(!t||!e)return;const n=window.location.href;function a(){e.style.display="none",e.setAttribute("aria-hidden","true")}function i(t="Link copied!"){r&&(r.textContent=t,r.hidden=!1,setTimeout((()=>r.hidden=!0),1600))}t.addEventListener("click",(t=>{t.stopPropagation(),e.style.display="block",e.setAttribute("aria-hidden","false")})),o?.addEventListener("click",a),e.addEventListener("click",(t=>{const e=t.target.getAttribute("data-action");e&&("copy"===e&&async function(){try{await navigator.clipboard.writeText(n),i("Link disalin ke clipboard")}catch(t){const e=document.createElement("textarea");e.value=n,document.body.appendChild(e),e.select();try{document.execCommand("copy"),i("Link disalin ke clipboard")}catch(t){alert("Copy failed. Link: "+n)}document.body.removeChild(e)}a()}(),"native"===e&&async function(){if(navigator.share)try{await navigator.share({title:document.title||"Check this product",text:"Lihat produk ini:",url:n})}catch(t){}else{const t="https://api.whatsapp.com/send?text="+encodeURIComponent(n);window.open(t,"_blank")}a()}())})),document.addEventListener("click",(r=>{e.contains(r.target)||r.target===t||a()})),function(){const t=t=>document.querySelector(t),e=t=>Number(String(t||0).replace(/[^\d]/g,""))||0;function r(){const t=[];var r;(r='.option-group button[aria-pressed="true"]',Array.from(document.querySelectorAll(r))).forEach((r=>{const o=r.dataset.choiceId||r.dataset.id||r.getAttribute("data-id")||r.textContent.trim(),n=r.dataset.label||r.textContent.trim(),a=e(r.dataset.price??r.dataset.priceDelta??r.getAttribute("data-price-delta"));t.push({id:String(o).replace(/_/g,"-"),label:n,price:a})}));const o=document.getElementById("product-options");return o&&(o.querySelectorAll("input").forEach((r=>{if(!r.disabled&&("checkbox"===r.type&&r.checked||"radio"===r.type&&r.checked)){const n=r.dataset.choiceId||r.id||r.name+"_"+r.value,a=r.dataset.label||o.querySelector(`label[for="${r.id}"]`)?.textContent?.trim()||n,i=e(r.dataset.price||r.getAttribute("data-price")||0);t.push({id:String(n).replace(/_/g,"-"),label:a.trim(),price:i})}})),o.querySelectorAll("select").forEach((r=>{const o=r.options[r.selectedIndex];if(o&&!o.disabled){const n=e(o.dataset.price||o.getAttribute("data-price")||0);t.push({id:r.name+"_"+o.value,label:o.text||o.value,price:n})}}))),t}function o(o=!0){const n=t(".product-name")?.dataset?.id||new URLSearchParams(location.search).get("id"),a=(t(".product-name")?.textContent||t(".product-title")?.textContent||"").trim(),i=e(t("#product-price")?.dataset?.base||t("#product-price")?.textContent),c=Number(t("#quantity")?.value||1);if(!n)return console.warn("no product id"),!1;const s=r(),d=function(t,e,r){const o=(r||[]).reduce(((t,e)=>t+Number(e.price||0)),0),n=Number(t||0)+o;return{unit:n,subtotal:n*Math.max(1,Number(e||1)),addTotal:o}}(i,c,s),u=t(".product-image"),l=u&&u.tagName&&"img"===u.tagName.toLowerCase()?u.src:t(".product-image img")?.src||"",p={id:String(n),title:a,unitPrice:Number(d.unit||0),qty:Number(c||1),addons:Array.isArray(s)?s:[],subtotal:Number(d.subtotal||0),image:l||""};let m=function(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(t){return[]}}();var g;return m=function(t,e){const r=t=>(t.addons||[]).map((t=>t.id)).sort().join("|"),o=r(e);for(let n=0;n<t.length;n++)if(t[n].id===e.id&&r(t[n])===o)return t[n].qty=Number(t[n].qty||1)+Number(e.qty||1),t[n].subtotal=Number(t[n].subtotal||0)+Number(e.subtotal||0),t;return t.push(e),t}(m,p),g=m,localStorage.setItem("cart",JSON.stringify(g||[])),function(t="Added to bag"){let e=document.querySelector(".mini-toast");e||(e=document.createElement("div"),e.className="mini-toast",e.style.cssText="position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#111;color:#fff;padding:8px 12px;border-radius:8px;z-index:1600;opacity:0;transition:opacity .18s",document.body.appendChild(e)),e.textContent=t,e.style.opacity="1",setTimeout((()=>e.style.opacity="0"),1200)}("Item added to bag"),o&&setTimeout((()=>window.location.href="bagfr.html"),450),!0}document.addEventListener("click",(t=>{const e=t.target.closest&&t.target.closest(".add-btn, [data-add-to-bag]");if(!e)return;t.preventDefault();o(!e.hasAttribute("data-no-redirect"))})),window.addToBagFromPage=o}(),function(){const t=t=>"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0));document.addEventListener("click",(function(e){if(!e.target.closest)return;if(!e.target.closest(".checkout, [data-checkout]"))return;e.preventDefault();const r=function(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(t){return[]}}();if(!r.length)return void alert("Keranjang kosong");let o=0;const n=r.map((t=>(o+=Number(t.subtotal||0),{id:t.id,title:t.title,qty:t.qty,unitPrice:t.unitPrice,addons:t.addons||[],subtotal:t.subtotal}))),a={id:"ORD-"+(new Date).toISOString().slice(0,10)+"-"+Math.random().toString(36).slice(2,6),createdAt:Date.now(),status:"active",items:n,total:o},i=function(){try{return JSON.parse(localStorage.getItem("orders")||"[]")}catch(t){return[]}}();var c;i.unshift(a),c=i,localStorage.setItem("orders",JSON.stringify(c||[]));const s="https://api.whatsapp.com/send?text="+encodeURIComponent(function(e){const r=[];return r.push(`ðŸ“¦ New Order â€” ${e.id}`),r.push(`Waktu: ${new Date(e.createdAt).toLocaleString("id-ID")}`),r.push(""),e.items.forEach((e=>{const o=(e.addons||[]).map((e=>`${e.label} (+${t(e.price)})`)).join(", ");r.push(`â€¢ ${e.title} x${e.qty} â€” ${t(e.unitPrice)} ${o?" | "+o:""} = ${t(e.subtotal)}`)})),r.push(""),r.push(`Total: ${t(e.total)}`),r.push(""),r.push("Nama:"),r.push("No. HP:"),r.push("Alamat / Catatan:"),r.push(""),r.push("Mohon konfirmasi ketersediaan & instruksi pembayaran via chat. Terima kasih!"),r.join("\n")}(a));window.open(s,"_blank"),window.location.href="order.html?order="+encodeURIComponent(a.id)}))}();const c={id:productId,title:productTitle,image:productImageSrc,price:Number(productPrice||0)};let s=JSON.parse(localStorage.getItem("likes")||"[]");s.unshift(c),localStorage.setItem("likes",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("likes:updated",{detail:{likes:s}}))}();