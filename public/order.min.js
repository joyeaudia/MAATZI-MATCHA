// @ts-nocheck
!function(){"use strict";function t(t){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0))}function e(t){try{return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}function a(t){return String(t||"").replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])))}function n(){return e("orders")}function d(t){const e=t.items&&t.items[0],n=Math.max(0,(t.items||[]).length-1),d=e?function(t){const e=String(t?.id||"").toLowerCase(),a=String(t?.title||"").toLowerCase();return e.startsWith("dsri")||e.startsWith("dessert")||a.includes("dessert")?"Desserts":e.startsWith("drsi")||e.startsWith("drink")||a.includes("latte")||a.includes("drink")?"Drinks":"Products"}(e):"Products",i=e&&e.image?'<img src="'+a(e.image)+'" alt="'+a(e.title)+'" style="width:68px;height:68px;object-fit:cover;border-radius:8px">':'<div class="thumb"></div>',s=t.status||"active",o=new Date(t.createdAt||Date.now()).toLocaleString(),c=document.createElement("article");return c.className="order-card",c.innerHTML='<div class="thumb">'+i+'</div><div class="order-info">  <div class="order-top">    <h3 class="product-title">'+a(e?e.title:"No title")+'</h3>    <span class="more">'+(n>0?"+"+n+" More":"")+'</span>  </div>  <p class="brand">'+a(d)+'</p>  <div class="status-row">    <span class="status">Status : <strong>'+a(s)+'</strong></span>    <span class="eta">Created : <em>'+a(o)+'</em></span>  </div>  <div class="order-actions">    <button class="btn-outline" data-order-id="'+a(t.id)+'">Track Order</button>    <button class="btn-light view-details" data-order-id="'+a(t.id)+'">View Details</button>  </div></div>',c.querySelectorAll(".view-details").forEach((t=>{t.addEventListener("click",(function(){r(this.dataset.orderId)}))})),c}function r(d){const r=(n()||[]).find((t=>String(t.id)===String(d))),s=["tab-active","tab-schedule","tab-scheduled","tab-history"];let o=null;for(const t of s){const e=document.getElementById(t);if(e){o=e;break}}if(!o)return;if(o.innerHTML="",!r)return void(o.innerHTML='<div style="padding:12px;color:#c33">Order tidak ditemukan.</div>');const c=document.createElement("h2");c.textContent="Order Details",o.appendChild(c);const l=document.createElement("div");l.style.marginTop="12px",(r.items||[]).forEach((e=>{const n=document.createElement("div");n.style.padding="10px 0",n.innerHTML='<div style="display:flex;gap:12px;align-items:center">  <div style="width:56px;height:56px;border-radius:8px;overflow:hidden;background:#f5f5f7;flex:0 0 56px">'+(e.image?'<img src="'+a(e.image)+'" style="width:100%;height:100%;object-fit:cover">':"")+'  </div>  <div style="flex:1">    <div style="font-weight:700">'+a(e.title)+"</div>"+(e.addons&&e.addons.length?'<div style="color:#666;margin-top:6px">'+e.addons.map((t=>a(t.label))).join(", ")+"</div>":"")+'    <div style="color:#666;margin-top:6px">'+(e.qty||0)+" × "+t(e.unitPrice)+" = "+t(e.subtotal)+"</div>  </div></div>",l.appendChild(n)})),o.appendChild(l);const u=e("savedAddresses_v1");let m=null;if(Array.isArray(u)&&u.length&&(m=u.find((t=>t&&t.isDefault))||u[0]),m){const t=document.createElement("div");t.className="order-address-block";const e=a(m.label||""),n=a(m.name||""),d=a(m.phone||""),r=a(m.address||"").replace(/\n/g,"<br>"),i=`${e||""}${e&&n?" - ":""}${n||""}`;t.innerHTML=`\n        <div class="order-address-head">\n          <span class="title">Address</span>\n          <a href="drafamt.html" class="edit-link small">Edit</a>\n        </div>\n        <div class="order-address-body">\n          <div class="line-combined">${i}</div>\n          ${d?`<div class="line-phone">${d}</div>`:""}\n          <div class="line-address">${r}</div>\n        </div>\n      `,o.appendChild(t)}const p=(r.paymentStatus||"pending").toLowerCase(),v=(r.status||"").toLowerCase(),h="paid"===p,g="rejected"===p||"cancelled"===v,b=document.createElement("div");let f="pending",y="";h?(f="paid",y="<div>Status pesanan: <strong>Pesanan "+a(r.id||"")+' sudah dibayar.</strong></div><div class="status">Pembayaran sudah diterima admin ✅</div><div class="track-hint">Anda dapat men-track order Anda dari halaman Orders / Active.</div>'):g?(f="rejected",y="<div>Status pesanan: <strong>Pesanan "+a(r.id||"")+' ditolak / dibatalkan.</strong></div><div class="status">Pembayaran tidak diterima admin.</div>'):(f="pending",y='<div>Segera melakukan pembayaran melalui WhatsApp kepada toko agar orderan Anda dapat di-ACC.</div><div class="status">Status pembayaran: <strong>Pembayaran belum diterima admin</strong></div>'),b.className="order-payment-note "+f,b.innerHTML=y,o.appendChild(b);const k=document.createElement("div");k.style.marginTop="12px",k.style.fontWeight="700",k.textContent="Total: "+t(r.total),o.appendChild(k);const E=document.createElement("div");E.style.marginTop="12px",E.innerHTML='<button class="btn-light" id="back-to-summary">Back to summary</button> <button class="btn-outline btn-cancel-order" data-order-id="'+a(r.id)+'">Cancel Order</button>',o.appendChild(E);const L=E.querySelector("#back-to-summary");L&&L.addEventListener("click",(function(){i()}));const S=E.querySelector(".btn-cancel-order");S&&S.addEventListener("click",(function(){if(!confirm("Yakin ingin membatalkan order ini?"))return;const t=n()||[],e=t.findIndex((t=>String(t.id)===String(d)));-1!==e&&(t[e].status="cancelled",t[e].paymentStatus="rejected",function(t){try{localStorage.setItem("orders",JSON.stringify(t||[]))}catch(t){console.error("Failed to save orders",t)}}(t)),i(),alert("Order telah dibatalkan. Status: cancelled")}))}function i(){!function(){const t=document.getElementById("tab-active");if(!t)return;t.innerHTML="";const e=n()||[];if(!e.length)return void(t.innerHTML='<div style="padding:16px;color:#666">Belum ada pesanan.</div>');let a=e.filter((t=>"active"===String(t.status||"").toLowerCase()));a.length||(a=e.filter((t=>!t.status))),a.length?a.forEach((e=>{t.appendChild(d(e))})):t.innerHTML='<div style="padding:16px;color:#666">Tidak ada pesanan aktif saat ini.</div>'}(),function(){const t=document.getElementById("tab-schedule")||document.getElementById("tab-scheduled");if(!t)return;t.innerHTML="";const e=(n()||[]).filter((t=>t.status&&"scheduled"===String(t.status).toLowerCase()||t.scheduledAt));e.length?e.forEach((e=>t.appendChild(d(e)))):t.innerHTML='<div style="padding:16px;color:#666">No scheduled orders.</div>'}(),function(){const t=document.getElementById("tab-history");if(!t)return;t.innerHTML="";const e=n(),a=(e||[]).filter((t=>{const e=String(t.status||"").toLowerCase();return"active"!==e&&"scheduled"!==e&&""!==e}));if(!a.length){const a=(e||[]).filter((t=>{try{return Date.now()-Number(t.createdAt||0)>864e5}catch(t){return!1}}));return a.length?void a.forEach((e=>t.appendChild(d(e)))):void(t.innerHTML='<div style="padding:16px;color:#666">History kosong.</div>')}a.forEach((e=>t.appendChild(d(e))))}()}document.addEventListener("DOMContentLoaded",(function(){try{i(),document.querySelectorAll("[data-order-tab],[data-tab]").forEach((t=>{t.addEventListener("click",(function(){const t=this.dataset.orderTab||this.dataset.tab;if(!t)return;const e={active:"tab-active",scheduled:"tab-scheduled",schedule:"tab-schedule",history:"tab-history"}[t]||t;["tab-active","tab-scheduled","tab-schedule","tab-history"].forEach((t=>{const a=document.getElementById(t);a&&(a.style.display=t===e?"":"none")})),document.querySelectorAll("[data-order-tab],[data-tab]").forEach((e=>{const a=(e.dataset.orderTab||e.dataset.tab)===t;e.classList.toggle("tab-active",a),e.setAttribute("aria-selected",a?"true":"false")}))}))}))}catch(t){console.error("order render error",t)}})),window.renderAllOrders=i,window.renderOrderDetails=r}();