// @ts-nocheck
!function(){"use strict";function t(t){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0))}function e(t){try{return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}function n(t){return String(t||"").replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])))}function a(){return e("orders")}function a(){return e("orders")}function i(t,e){const i="history"===(e&&e.context||""),r=t.items&&t.items[0],s=Math.max(0,(t.items||[]).length-1),o=r?function(t){const e=String(t?.id||"").toLowerCase(),n=String(t?.title||"").toLowerCase();return e.startsWith("dsri")||e.startsWith("dessert")||n.includes("dessert")?"Desserts":e.startsWith("drsi")||e.startsWith("drink")||n.includes("latte")||n.includes("drink")?"Drinks":"Products"}(r):"Products",c=r&&r.image?'<img src="'+n(r.image)+'" alt="'+n(r.title)+'" style="width:68px;height:68px;object-fit:cover;border-radius:8px">':'<div class="thumb"></div>',l=t.status||"active",u=String(l).toLowerCase(),m=new Date(t.createdAt||Date.now()).toLocaleString();let h="";if(i&&"cancelled"===u)h='  <div class="order-actions">    <button class="btn-outline reorder-btn" data-order-id="'+n(t.id)+'">Reorder</button>    <button class="btn-light view-details" data-order-id="'+n(t.id)+'">View Details</button>  </div>';else{const e=i?"Reorder":"View Details",a=i?"reorder-btn":"view-details";h='  <div class="order-actions">    <button class="btn-outline track-btn" data-order-id="'+n(t.id)+'">Track Order</button>    <button class="btn-light '+a+'" data-order-id="'+n(t.id)+'">'+e+"</button>  </div>"}const v=document.createElement("article");return v.className="order-card",v.innerHTML='<div class="thumb">'+c+'</div><div class="order-info">  <div class="order-top">    <h3 class="product-title">'+n(r?r.title:"No title")+'</h3>    <span class="more">'+(s>0?"+"+s+" More":"")+'</span>  </div>  <p class="brand">'+n(o)+'</p>  <div class="status-row">    <span class="status">Status : <strong>'+n(l)+'</strong></span>    <span class="eta">Created : <em>'+n(m)+"</em></span>  </div>"+h+"</div>",v.querySelectorAll(".view-details").forEach((t=>{t.addEventListener("click",(function(){d(this.dataset.orderId)}))})),v.querySelectorAll(".reorder-btn").forEach((t=>{t.addEventListener("click",(function(){const t=this.dataset.orderId;t&&function(t){const e=(a()||[]).find((e=>String(e.id)===String(t)));if(!e)return void alert("Order tidak ditemukan.");let n=function(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(t){return[]}}()||[];(e.items||[]).forEach(((t,a)=>{if(!t)return;const i=Number(t.qty||1),d=Number(t.unitPrice||t.price||0),r=Number(t.subtotal||d*i),s={id:t.id||`reorder-${e.id}-${a}`,title:t.title||"",unitPrice:d,qty:i,subtotal:r,image:t.image||t.images&&t.images[0]||"assets/placeholder.png",addons:t.addons||[],source:"reorder"};n.push(s)})),function(t){try{localStorage.setItem("cart",JSON.stringify(t||[]))}catch(t){console.error("Failed to save bag items",t)}}(n),alert("Barang dari order ini sudah dimasukkan ke Bag ✔"),window.location.href="bagfr.html"}(t)}))})),v.querySelectorAll(".track-btn").forEach((t=>{t.addEventListener("click",(function(){const t=this.dataset.orderId;t&&(window.location.href="ditel.html?id="+encodeURIComponent(t))}))})),v}function d(i){const d=(a()||[]).find((t=>String(t.id)===String(i))),r=["tab-active","tab-schedule","tab-scheduled","tab-history"];let o=null;for(const t of r){const e=document.getElementById(t);if(!e)continue;const n="none"===e.style.display,a=e.classList.contains("hidden");if(!n&&!a){o=e;break}}if(o||(o=document.getElementById("tab-history")||document.getElementById("tab-active")),!o)return;if(o.innerHTML="",!d)return void(o.innerHTML='<div style="padding:12px;color:#c33">Order tidak ditemukan.</div>');const c=document.createElement("h2");c.textContent="Order Details",o.appendChild(c);const l=document.createElement("div");l.style.marginTop="12px",(d.items||[]).forEach((e=>{const a=document.createElement("div");a.style.padding="10px 0",a.innerHTML='<div style="display:flex;gap:12px;align-items:center">  <div style="width:56px;height:56px;border-radius:8px;overflow:hidden;background:#f5f5f7;flex:0 0 56px">'+(e.image?'<img src="'+n(e.image)+'" style="width:100%;height:100%;object-fit:cover">':"")+'  </div>  <div style="flex:1">    <div style="font-weight:700">'+n(e.title)+"</div>"+(e.addons&&e.addons.length?'<div style="color:#666;margin-top:6px">'+e.addons.map((t=>n(t.label))).join(", ")+"</div>":"")+'    <div style="color:#666;margin-top:6px">'+(e.qty||0)+" × "+t(e.unitPrice)+" = "+t(e.subtotal)+"</div>  </div></div>",l.appendChild(a)})),o.appendChild(l);const u=e("savedAddresses_v1");let m=null;if(Array.isArray(u)&&u.length&&(m=u.find((t=>t&&t.isDefault))||u[0]),m){const t=document.createElement("div");t.className="order-address-block";const e=n(m.label||""),a=n(m.name||""),i=n(m.phone||""),d=n(m.address||"").replace(/\n/g,"<br>"),r=`${e||""}${e&&a?" - ":""}${a||""}`;t.innerHTML=`\n      <div class="order-address-head">\n        <span class="title">Address</span>\n        <a href="drafamt.html" class="edit-link small">Edit</a>\n      </div>\n      <div class="order-address-body">\n        <div class="line-combined">${r}</div>\n        ${i?`<div class="line-phone">${i}</div>`:""}\n        <div class="line-address">${d}</div>\n      </div>\n    `,o.appendChild(t)}const h=(d.paymentStatus||"pending").toLowerCase(),v=(d.status||"").toLowerCase(),p="paid"===h,g="rejected"===h||"cancelled"===v,f=document.createElement("div");let b="pending",y="";p?(b="paid",y="<div>Status pesanan: <strong>Pesanan "+n(d.id||"")+' sudah dibayar.</strong></div><div class="status">Pembayaran sudah diterima admin ✅</div><div class="track-hint">Anda dapat men-track order Anda dari halaman Orders / Active.</div>'):g?f.innerHTML='<div style="font-weight:600">⛔ Orderan ini dicancel oleh admin</div><div class="status">Status pembayaran: <strong style="color:#c00">Ditolak admin</strong></div><div class="track-hint" style="color:#c00">Silakan hubungi admin jika ada kesalahan.</div>':(b="pending",y='<div>Segera melakukan pembayaran melalui WhatsApp kepada toko agar orderan Anda dapat di-ACC.</div><div class="status">Status pembayaran: <strong>Pembayaran belum diterima admin</strong></div>'),g||(f.className="order-payment-note "+b,f.innerHTML=y),o.appendChild(f);const k=document.createElement("div");k.style.marginTop="12px",k.style.fontWeight="700",k.textContent="Total: "+t(d.total),o.appendChild(k);const w=document.createElement("div");w.style.marginTop="12px",w.innerHTML='<button class="btn-light" id="back-to-summary">Back to summary</button>',o.appendChild(w);const L=w.querySelector("#back-to-summary");L&&L.addEventListener("click",(function(){s()}))}function r(){const t=document.getElementById("notif-badge");if(!t)return;const n=e("notifications_v1");Array.isArray(n)&&n.some((t=>!t.isRead))?t.classList.add("show"):t.classList.remove("show")}function s(){!function(){const t=document.getElementById("tab-active");if(!t)return;t.innerHTML="";const e=a()||[];if(!e.length)return void(t.innerHTML='<div style="padding:16px;color:#666">Belum ada pesanan.</div>');let n=e.filter((t=>"active"===String(t.status||"").toLowerCase()));n.length||(n=e.filter((t=>!t.status))),n.length?n.forEach((e=>{t.appendChild(i(e,{context:"active"}))})):t.innerHTML='<div style="padding:16px;color:#666">Tidak ada pesanan aktif saat ini.</div>'}(),function(){const t=document.getElementById("tab-schedule")||document.getElementById("tab-scheduled");if(!t)return;t.innerHTML="";const e=(a()||[]).filter((t=>{const e=String(t.status||"").toLowerCase();return!["delivered","completed","cancelled"].includes(e)&&("scheduled"===e||t.scheduledAt)}));e.length?e.forEach((e=>{t.appendChild(i(e,{context:"scheduled"}))})):t.innerHTML='<div style="padding:16px;color:#666">No scheduled orders.</div>'}(),function(){const t=document.getElementById("tab-history");if(!t)return;t.innerHTML="";const e=(a()||[]).filter((t=>{const e=String(t.status||"").toLowerCase();return["delivered","completed","cancelled"].includes(e)}));e.length?e.forEach((e=>{t.appendChild(i(e,{context:"history"}))})):t.innerHTML='<div style="padding:16px;color:#666">History kosong.</div>'}()}document.addEventListener("DOMContentLoaded",(function(){try{s(),document.querySelectorAll("[data-order-tab],[data-tab]").forEach((t=>{t.addEventListener("click",(function(){const t=this.dataset.orderTab||this.dataset.tab;if(!t)return;const e={active:"tab-active",scheduled:"tab-scheduled",schedule:"tab-schedule",history:"tab-history"}[t]||t;["tab-active","tab-scheduled","tab-schedule","tab-history"].forEach((t=>{const n=document.getElementById(t);if(!n)return;const a=t===e;n.style.display=a?"":"none",n.classList.toggle("hidden",!a)})),document.querySelectorAll("[data-order-tab],[data-tab]").forEach((e=>{const n=(e.dataset.orderTab||e.dataset.tab)===t;e.classList.toggle("tab-active",n),e.setAttribute("aria-selected",n?"true":"false")}))}))})),r(),window.addEventListener("storage",(function(t){"notifications_v1"===t.key&&r()}))}catch(t){console.error("order render error",t)}})),window.renderAllOrders=s,window.renderOrderDetails=d,window.updateNotifBadge=r}();