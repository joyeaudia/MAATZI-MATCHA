// @ts-nocheck
!function(){"use strict";function e(e){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(e||0))}function t(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}function n(e){return String(e||"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])))}function i(){return t("orders")}function i(){return t("orders")}function a(e,t){const a="history"===(t&&t.context||""),r=e.items&&e.items[0],s=Math.max(0,(e.items||[]).length-1),o=r?function(e){const t=String(e?.id||"").toLowerCase(),n=String(e?.title||"").toLowerCase();return t.startsWith("dsri")||t.startsWith("dessert")||n.includes("dessert")?"Desserts":t.startsWith("drsi")||t.startsWith("drink")||n.includes("latte")||n.includes("drink")?"Drinks":"Products"}(r):"Products",c=r&&r.image?'<img src="'+n(r.image)+'" alt="'+n(r.title)+'" style="width:68px;height:68px;object-fit:cover;border-radius:8px">':'<div class="thumb"></div>',l=e.status||"active",u=String(l).toLowerCase(),m=new Date(e.createdAt||Date.now()).toLocaleString();let g="";if(a&&"cancelled"===u)g='  <div class="order-actions">    <button class="btn-outline reorder-btn" data-order-id="'+n(e.id)+'">Reorder</button>    <button class="btn-light view-details" data-order-id="'+n(e.id)+'">View Details</button>  </div>';else{const t=a?"Reorder":"View Details",i=a?"reorder-btn":"view-details";g='  <div class="order-actions">    <button class="btn-outline track-btn" data-order-id="'+n(e.id)+'">Track Order</button>    <button class="btn-light '+i+'" data-order-id="'+n(e.id)+'">'+t+"</button>  </div>"}const v=document.createElement("article");return v.className="order-card",v.innerHTML='<div class="thumb">'+c+'</div><div class="order-info">  <div class="order-top">    <h3 class="product-title">'+n(r?r.title:"No title")+'</h3>    <span class="more">'+(s>0?"+"+s+" More":"")+'</span>  </div>  <p class="brand">'+n(o)+'</p>  <div class="status-row">    <span class="status">Status : <strong>'+n(l)+'</strong></span>    <span class="eta">Created : <em>'+n(m)+"</em></span>  </div>"+g+"</div>",v.querySelectorAll(".view-details").forEach((e=>{e.addEventListener("click",(function(){d(this.dataset.orderId)}))})),v.querySelectorAll(".reorder-btn").forEach((e=>{e.addEventListener("click",(function(){const e=this.dataset.orderId;e&&function(e){const t=(i()||[]).find((t=>String(t.id)===String(e)));if(!t)return void alert("Order tidak ditemukan.");let n=function(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(e){return[]}}()||[];(t.items||[]).forEach(((e,i)=>{if(!e)return;const a=Number(e.qty||1),d=Number(e.unitPrice||e.price||0),r=Number(e.subtotal||d*a),s={id:e.id||`reorder-${t.id}-${i}`,title:e.title||"",unitPrice:d,qty:a,subtotal:r,image:e.image||e.images&&e.images[0]||"assets/placeholder.png",addons:e.addons||[],source:"reorder"};n.push(s)})),function(e){try{localStorage.setItem("cart",JSON.stringify(e||[]))}catch(e){console.error("Failed to save bag items",e)}}(n),alert("Barang dari order ini sudah dimasukkan ke Bag ‚úî"),window.location.href="bagfr.html"}(e)}))})),v.querySelectorAll(".track-btn").forEach((e=>{e.addEventListener("click",(function(){const e=this.dataset.orderId;e&&(window.location.href="ditel.html?id="+encodeURIComponent(e))}))})),v}function d(a){const d=(i()||[]).find((e=>String(e.id)===String(a))),r=["tab-active","tab-schedule","tab-scheduled","tab-history"];let o=null;for(const e of r){const t=document.getElementById(e);if(!t)continue;const n="none"===t.style.display,i=t.classList.contains("hidden");if(!n&&!i){o=t;break}}if(o||(o=document.getElementById("tab-history")||document.getElementById("tab-active")),!o)return;if(o.innerHTML="",!d)return void(o.innerHTML='<div style="padding:12px;color:#c33">Order tidak ditemukan.</div>');const c=document.createElement("h2");c.textContent="Order Details",o.appendChild(c);const l=document.createElement("div");if(l.style.marginTop="12px",(d.items||[]).forEach((t=>{const i=document.createElement("div");i.style.padding="10px 0",i.innerHTML='<div style="display:flex;gap:12px;align-items:center">  <div style="width:56px;height:56px;border-radius:8px;overflow:hidden;background:#f5f5f7;flex:0 0 56px">'+(t.image?'<img src="'+n(t.image)+'" style="width:100%;height:100%;object-fit:cover">':"")+'  </div>  <div style="flex:1">    <div style="font-weight:700">'+n(t.title)+"</div>"+(t.addons&&t.addons.length?'<div style="color:#666;margin-top:6px">'+t.addons.map((e=>n(e.label))).join(", ")+"</div>":"")+'    <div style="color:#666;margin-top:6px">'+(t.qty||0)+" √ó "+e(t.unitPrice)+" = "+e(t.subtotal)+"</div>  </div></div>",l.appendChild(i)})),o.appendChild(l),d.isGift&&d.gift){const e=document.createElement("div");e.className="order-gift-block",e.style.marginTop="12px",e.style.padding="12px",e.style.borderRadius="10px",e.style.background="#fff6fb";const t="surprise"===String(d.gift.revealMode||"reveal")?"Keep it a surprise":"Reveal it now";let i="";if(d.scheduledAt)try{i="<div><strong>Schedule:</strong> "+n(new Date(d.scheduledAt).toLocaleString("id-ID"))+"</div>"}catch(e){}const a=d.gift.message?"<div><strong>Message:</strong> "+n(d.gift.message)+"</div>":"",r=d.gift.fromName?"<div><strong>From:</strong> "+n(d.gift.fromName)+"</div>":"",s=d.gift.theme?"<div><strong>Card theme:</strong> "+n(d.gift.theme)+"</div>":"";e.innerHTML='<div style="font-weight:600;margin-bottom:4px">üéÅ Gift details</div>'+a+r+"<div><strong>Reveal:</strong> "+n(t)+"</div>"+s+i,o.appendChild(e)}const u=d.meta&&"string"==typeof d.meta.recipient?d.meta.recipient.trim():"";if(u){const e=document.createElement("div");e.className="order-address-block";const t=n(u).replace(/\n/g,"<br>");e.innerHTML=`\n      <div class="order-address-head">\n        <span class="title">Recipient</span>\n      </div>\n      <div class="order-address-body">\n        <div class="line-address">${t}</div>\n      </div>\n    `,o.appendChild(e)}else{const e=t("savedAddresses_v1");let i=null;if(Array.isArray(e)&&e.length&&(i=e.find((e=>e&&e.isDefault))||e[0]),i){const e=document.createElement("div");e.className="order-address-block";const t=n(i.label||""),a=n(i.name||""),d=n(i.phone||""),r=n(i.address||"").replace(/\n/g,"<br>"),s=`${t||""}${t&&a?" - ":""}${a||""}`;e.innerHTML=`\n        <div class="order-address-head">\n          <span class="title">Address</span>\n          <a href="drafamt.html" class="edit-link small">Edit</a>\n        </div>\n        <div class="order-address-body">\n          <div class="line-combined">${s}</div>\n          ${d?`<div class="line-phone">${d}</div>`:""}\n          <div class="line-address">${r}</div>\n        </div>\n      `,o.appendChild(e)}}const m=(d.paymentStatus||"pending").toLowerCase(),g=(d.status||"").toLowerCase(),v="paid"===m,h="rejected"===m||"cancelled"===g,p=document.createElement("div");let f="pending",b="";v?(f="paid",b="<div>Status pesanan: <strong>Pesanan "+n(d.id||"")+' sudah dibayar.</strong></div><div class="status">Pembayaran sudah diterima admin ‚úÖ</div><div class="track-hint">Anda dapat men-track order Anda dari halaman Orders / Active.</div>'):h?p.innerHTML='<div style="font-weight:600">‚õî Orderan ini dicancel oleh admin</div><div class="status">Status pembayaran: <strong style="color:#c00">Ditolak admin</strong></div><div class="track-hint" style="color:#c00">Silakan hubungi admin jika ada kesalahan.</div>':(f="pending",b='<div>Segera melakukan pembayaran melalui WhatsApp kepada toko agar orderan Anda dapat di-ACC.</div><div class="status">Status pembayaran: <strong>Pembayaran belum diterima admin</strong></div>'),h||(p.className="order-payment-note "+f,p.innerHTML=b),o.appendChild(p);const y=document.createElement("div");y.style.marginTop="12px",y.style.fontWeight="700",y.textContent="Total: "+e(d.total),o.appendChild(y);const k=document.createElement("div");k.style.marginTop="12px",k.innerHTML='<button class="btn-light" id="back-to-summary">Back to summary</button>',o.appendChild(k);const w=k.querySelector("#back-to-summary");w&&w.addEventListener("click",(function(){s()}))}function r(){const e=document.getElementById("notif-badge");if(!e)return;const n=t("notifications_v1");Array.isArray(n)&&n.some((e=>!e.isRead))?e.classList.add("show"):e.classList.remove("show")}function s(){!function(){const e=document.getElementById("tab-active");if(!e)return;e.innerHTML="";const t=i()||[];if(!t.length)return void(e.innerHTML='<div style="padding:16px;color:#666">Belum ada pesanan.</div>');let n=t.filter((e=>"active"===String(e.status||"").toLowerCase()));n.length||(n=t.filter((e=>!e.status))),n.length?n.forEach((t=>{e.appendChild(a(t,{context:"active"}))})):e.innerHTML='<div style="padding:16px;color:#666">Tidak ada pesanan aktif saat ini.</div>'}(),function(){const e=document.getElementById("tab-schedule")||document.getElementById("tab-scheduled");if(!e)return;e.innerHTML="";const t=(i()||[]).filter((e=>{const t=String(e.status||"").toLowerCase();return!["delivered","completed","cancelled"].includes(t)&&("scheduled"===t||e.scheduledAt)}));t.length?t.forEach((t=>{e.appendChild(a(t,{context:"scheduled"}))})):e.innerHTML='<div style="padding:16px;color:#666">No scheduled orders.</div>'}(),function(){const e=document.getElementById("tab-history");if(!e)return;e.innerHTML="";const t=(i()||[]).filter((e=>{const t=String(e.status||"").toLowerCase();return["delivered","completed","cancelled"].includes(t)}));t.length?t.forEach((t=>{e.appendChild(a(t,{context:"history"}))})):e.innerHTML='<div style="padding:16px;color:#666">History kosong.</div>'}()}document.addEventListener("DOMContentLoaded",(function(){try{s(),document.querySelectorAll("[data-order-tab],[data-tab]").forEach((e=>{e.addEventListener("click",(function(){const e=this.dataset.orderTab||this.dataset.tab;if(!e)return;const t={active:"tab-active",scheduled:"tab-scheduled",schedule:"tab-schedule",history:"tab-history"}[e]||e;["tab-active","tab-scheduled","tab-schedule","tab-history"].forEach((e=>{const n=document.getElementById(e);if(!n)return;const i=e===t;n.style.display=i?"":"none",n.classList.toggle("hidden",!i)})),document.querySelectorAll("[data-order-tab],[data-tab]").forEach((t=>{const n=(t.dataset.orderTab||t.dataset.tab)===e;t.classList.toggle("tab-active",n),t.setAttribute("aria-selected",n?"true":"false")}))}))})),r(),window.addEventListener("storage",(function(e){"notifications_v1"===e.key&&r()}))}catch(e){console.error("order render error",e)}})),window.renderAllOrders=s,window.renderOrderDetails=d,window.updateNotifBadge=r}();