// @ts-nocheck
!function(){"use strict";function e(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}function t(e){localStorage.setItem("orders",JSON.stringify(e||[]))}function n(e){return String(e||"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])))}function d(t){const d=document.getElementById("adm-order-id"),i=document.getElementById("adm-order-date"),a=document.getElementById("adm-status-text"),c=document.getElementById("adm-payment-badge"),r=document.getElementById("adm-total-badge"),o=document.getElementById("adm-items"),l=document.getElementById("adm-address-block");if(d&&(d.textContent=t.id||"(no id)"),i){const e=t.createdAt?new Date(t.createdAt):new Date;i.textContent=e.toLocaleString()}const m=(t.status||"active").toLowerCase();a&&(a.textContent=m);const s=(t.paymentStatus||"pending").toLowerCase();var u;if(c&&(c.textContent="Payment: "+s,c.classList.remove("paid","rejected"),"paid"===s&&c.classList.add("paid"),"rejected"===s&&c.classList.add("rejected")),r&&(r.textContent="Total: "+(u=t.total||0,"Rp "+new Intl.NumberFormat("id-ID").format(Number(u||0)))),o){const e=t.items&&t.items[0],d=Math.max(0,(t.items||[]).length-1);o.innerHTML=e?`<div>${n(e.title||"No title")}${d>0?" +"+d+" more":""}</div>`:"<div>No items</div>"}const g=e("savedAddresses_v1");let v=null;if(Array.isArray(g)&&g.length&&(v=g.find((e=>e&&e.isDefault))||g[0]),l&&v){const e=n(v.label||""),t=n(v.name||""),d=n(v.phone||""),i=n(v.address||"").replace(/\n/g,"<br>"),a=`${e||""}${e&&t?" - ":""}${t||""}`;l.innerHTML=`\n        <div class="admin-address-title">Address</div>\n        <div class="admin-address-main">\n          <div>${a}</div>\n          ${d?`<div>${d}</div>`:""}\n          <div>${i}</div>\n        </div>\n      `}}document.addEventListener("DOMContentLoaded",(function(){const n=new URLSearchParams(window.location.search).get("id"),i=e("orders"),a=(i||[]).find((e=>String(e.id)===String(n)));if(!a)return alert("Order tidak ditemukan."),void(window.location.href="ordadm.html");d(a),function(e){const t=document.getElementById("adm-scheduled"),n=document.getElementById("adm-ship-fee"),d=document.getElementById("t-placed"),i=document.getElementById("t-payment"),a=document.getElementById("t-wait"),c=document.getElementById("t-prep"),r=document.getElementById("t-out-active"),o=document.getElementById("t-out-info"),l=e.tracking||{},m=(e.paymentStatus||"pending").toLowerCase();if(t)if(e.scheduledDelivery)t.value=e.scheduledDelivery;else if(e.scheduledAt)try{const n=new Date(e.scheduledAt);t.value=n.toISOString().slice(0,10)}catch(e){}n&&(n.value=null!=e.shippingFee?e.shippingFee:""),d&&(d.checked=null==l.placed||!!l.placed),i&&(i.checked=null!=l.paymentConfirmed?!!l.paymentConfirmed:"paid"===m),a&&(a.checked=!!l.waitingForSchedule),c&&(c.checked=!!l.preparingOrder);const s=l.outForDelivery||{};r&&(r.checked=!!s.active),o&&(o.value=s.info||"")}(a),function(e,n){const d=document.getElementById("adm-scheduled"),i=document.getElementById("adm-ship-fee"),a=document.getElementById("t-placed"),c=document.getElementById("t-payment"),r=document.getElementById("t-wait"),o=document.getElementById("t-prep"),l=document.getElementById("t-out-active"),m=document.getElementById("t-out-info"),s=document.getElementById("btn-save-tracking"),u=document.getElementById("btn-mark-delivered"),g=document.getElementById("btn-back-list");s&&s.addEventListener("click",(function(){if(d&&d.value?e.scheduledDelivery=d.value:delete e.scheduledDelivery,i){const t=Number(i.value||0);isNaN(t)||(e.shippingFee=t,"number"==typeof e.subtotal&&(e.total=e.subtotal+t))}e.tracking={placed:!a||!!a.checked,paymentConfirmed:!!c&&!!c.checked,waitingForSchedule:!!r&&!!r.checked,preparingOrder:!!o&&!!o.checked,outForDelivery:{active:!!l&&!!l.checked,info:m?m.value.trim():""},delivered:!(!e.tracking||!e.tracking.delivered)};const s=n.findIndex((t=>String(t.id)===String(e.id)));-1!==s&&(n[s]=e,t(n)),alert("Perubahan tracking & delivery berhasil disimpan.")})),u&&u.addEventListener("click",(function(){if(!confirm("Tandai order ini sebagai DELIVERED dan pindahkan ke History user?"))return;e.status="delivered",e.tracking=Object.assign({},e.tracking||{},{delivered:!0,deliveredAt:Date.now()});const d=n.findIndex((t=>String(t.id)===String(e.id)));-1!==d&&(n[d]=e,t(n)),alert("Order telah ditandai sebagai DELIVERED."),window.location.href="ordadm.html"})),g&&g.addEventListener("click",(function(){window.location.href="ordadm.html"}))}(a,i)}))}();