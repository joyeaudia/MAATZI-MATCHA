// @ts-nocheck
!async function(){"use strict";const t=t=>document.querySelector(t),e=t=>"Rp "+new Intl.NumberFormat("id-ID").format(Number(t)||0);function r(t,e={}){const r=document.createElement(t);return Object.entries(e).forEach((([t,e])=>{"text"===t?r.textContent=e:"html"===t?r.innerHTML=e:"class"===t?r.className=e:r.setAttribute(t,String(e))})),r}function a(t=[]){const e=document.getElementById("product-options");e&&(e.innerHTML="",Array.isArray(t)&&0!==t.length?(e.style.display="",t.forEach((t=>{const a=r("fieldset",{class:"opt-group"}),i=r("legend",{text:t.title||""});a.appendChild(i),t.note&&a.appendChild(r("p",{class:"opt-note",text:t.note}));const o=t.key||"opt_"+Math.random().toString(36).slice(2,7);if("select"===t.type){const i=r("select",{name:o});return i.addEventListener("change",(()=>n())),t.choices.forEach((t=>{const e=r("option",{value:t.id,text:t.label||t.id});e.dataset.price=t.price||0,!1===t.enabled&&(e.disabled=!0),t.default&&(e.selected=!0),i.appendChild(e)})),a.appendChild(i),void e.appendChild(a)}const c=r("div",{class:"choices"});t.choices.forEach((e=>{const a="checkbox"===t.type&&"sauce"!==t.key,i=r("button",{class:a?"addon-btn":"opt-btn",type:"button","data-price":e.price||0,"data-choice-id":e.id,"aria-pressed":e.default?"true":"false","aria-label":e.label||e.id,text:e.label||e.id});if(!1===e.enabled&&(i.disabled=!0,i.classList.add("disabled")),e.price){const t=r("small",{class:"opt-price",text:" (+"+new Intl.NumberFormat("id-ID").format(e.price)+")"});i.appendChild(t)}i.addEventListener("click",(()=>{if(!1!==e.enabled){if(a){const t="true"===i.getAttribute("aria-pressed");i.setAttribute("aria-pressed",(!t).toString())}else c.querySelectorAll("button").forEach((t=>t.setAttribute("aria-pressed","false"))),i.setAttribute("aria-pressed","true");n()}})),i.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key&&"Spacebar"!==t.key||(t.preventDefault(),i.click())})),c.appendChild(i)})),a.appendChild(c),e.appendChild(a)})),n()):e.style.display="none")}function i(){const t=document.getElementById("product-options");if(!t)return 0;let e=0;return t.querySelectorAll("input").forEach((t=>{t.disabled||("checkbox"===t.type&&t.checked&&(e+=Number(t.dataset.price||0)),"radio"===t.type&&t.checked&&(e+=Number(t.dataset.price||0)))})),t.querySelectorAll("select").forEach((t=>{if(t.disabled)return;const r=t.options[t.selectedIndex];r&&!r.disabled&&(e+=Number(r.dataset.price||0))})),t.querySelectorAll("button[data-choice-id]").forEach((t=>{t.disabled||"true"===t.getAttribute("aria-pressed")&&(e+=Number(t.dataset.price||0))})),e}function n(){try{const t=Number(window.productBasePrice||0),r=i(),a=Number(document.getElementById("quantity")?.value||1),n=(t+r)*Math.max(1,a),o=document.getElementById("product-price");o&&(o.textContent=e(t+r));const c=document.getElementById("price-display")||document.getElementById("product-price");c&&(c.textContent=e(n))}catch(t){console.error("updatePriceFromUI error",t)}}function o(){document.querySelectorAll(".option-group").forEach((t=>{const e=Array.from(t.querySelectorAll("button"));if(!e.length)return;const r="addons"===t.dataset.key;e.forEach((t=>{void 0===t.dataset.price&&(t.dataset.price=t.getAttribute("data-price")||0),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.addEventListener("click",(()=>{if(r){const e="true"===t.getAttribute("aria-pressed");t.setAttribute("aria-pressed",(!e).toString())}else e.forEach((t=>t.setAttribute("aria-pressed","false"))),t.setAttribute("aria-pressed","true");n()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key&&"Spacebar"!==e.key||(e.preventDefault(),t.click())}))}))}))}try{const r=new URLSearchParams(location.search).get("id"),i="dsri";if(r){const c=(await async function(){const t=["dsri.json","products.json","/dsri.json","/products.json"];for(const e of t)try{const t=await fetch(e,{cache:"no-store"});if(!t.ok)continue;const r=await t.json();if(Array.isArray(r))return r}catch(t){}throw new Error("products file not found (tried dsri.json/products.json)")}()||[]).map((t=>{const e=String(t.id||t._id||t.code||""),r=e&&!e.startsWith(i+"-")?i+"-"+e:e;return Object.assign({},t,{id:r,source:i})})),d=r&&!r.startsWith(i+"-")?i+"-"+r:r,s=c.find((t=>t.id===d));if(s){!function(r){const a=t(".product-name"),i=t(".product-subtitle"),n=t("#product-price"),o=t(".product-image"),c=t("#detail-desc"),d=t("#quantity");if(a&&(a.textContent=r.title||"",a.dataset.id=r.id||"",a.dataset.source=r.source||"dsri"),i&&(i.textContent=r.subtitle||""),window.productBasePrice=Number(r.price||0),n&&(n.dataset.base=window.productBasePrice,n.textContent=e(window.productBasePrice),n.setAttribute("aria-live","polite")),o){const t=r.images&&r.images[0]||"",e=r.title||"";o.tagName&&"img"===o.tagName.toLowerCase()?(o.src=t,o.alt=e):o.innerHTML=`<img src="${t}" alt="${e}" />`}c&&(c.innerHTML=r.description||"");const s=document.getElementById("tips-list");s&&(Array.isArray(r.tips)&&r.tips.length>0?(s.innerHTML="",r.tips.forEach((t=>{const e=document.createElement("li");e.textContent=t,s.appendChild(e)}))):s.innerHTML="\n          <li>Serve chilled for best taste.</li>\n          <li>Consume within 4 hours for optimal freshness.</li>\n        "),d&&(!d.value||Number(d.value)<=0)&&(d.value=1)}(s);a(s.options||s.optionGroups||[]),o();const r=document.getElementById("quantity");r&&r.addEventListener("change",n)}else console.error("Product not found for id:",r),o()}else console.error("No product id in URL (use ?id=product-id). Keeping static/default content if present."),o(),document.getElementById("quantity")?.addEventListener("change",n)}catch(t){console.error("Error loading product:",t)}window.renderOptions=a,window.updatePriceFromUI=n,window.computeOptionsDelta=i,function(){const t=document.querySelector(".heart")||document.querySelector(".like-toggle")||document.querySelector("[data-like-button]");if(!t)return;const e=t=>localStorage.setItem("likes",JSON.stringify(t||[]));function r(t){let e=document.querySelector(".mini-toast");e||(e=document.createElement("div"),e.className="mini-toast",Object.assign(e.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",bottom:"28px",background:"#111",color:"#fff",padding:"8px 12px",borderRadius:"8px",zIndex:1600,opacity:0,transition:"opacity .18s"}),document.body.appendChild(e)),e.textContent=t,e.style.opacity="1",setTimeout((()=>e.style.opacity="0"),1300)}t.addEventListener("click",(function(a){a.preventDefault();const i=function(){const t=document.querySelector(".product-name"),e=t?.dataset?.id||new URLSearchParams(location.search).get("id")||"",r=t?.dataset?.source||"dsri",a=e&&!e.startsWith(r+"-")?r+"-"+e:String(e),i=t?.textContent?.trim()||document.title||"";let n=document.querySelector(".product-image img")||document.querySelector(".product-image")||document.querySelector(".product-thumb img")||document.querySelector(".product-thumb")||null,o="";n&&(o=n.tagName&&"img"===n.tagName.toLowerCase()?n.src||n.getAttribute("src")||"":n.querySelector&&(n.querySelector("img")?.src||n.querySelector("img")?.getAttribute("src"))||"");try{o&&(o=new URL(o,location.href).href)}catch(t){}const c=Number(document.getElementById("product-price")?.dataset?.base||0);return{id:String(a),source:r,title:i,image:o||"",price:c}}();if(!i.id)return void r("Tidak dapat menyukai item ini (id produk tidak ditemukan)");let n=(()=>{try{return JSON.parse(localStorage.getItem("likes")||"[]")}catch(t){return[]}})();const o=n.findIndex((t=>String(t.id)===String(i.id))),c="true"===t.getAttribute("aria-pressed");t.setAttribute("aria-pressed",c?"false":"true"),c?(o>-1&&n.splice(o,1),e(n),r("Dihapus dari Liked")):(-1===o&&n.unshift(i),e(n),r("Ditambahkan ke Liked")),window.dispatchEvent(new CustomEvent("likes:updated",{detail:{likes:n}}))}))}(),function(){const t=t=>document.querySelector(t);function e(e=!0){const r=t(".product-name")?.dataset?.id||new URLSearchParams(location.search).get("id"),a=t(".product-name")?.dataset?.source||"dsri",i=r&&!r.startsWith(a+"-")?a+"-"+r:r,n=(t(".product-name")?.textContent||t(".product-title")?.textContent||"").trim(),o=(c=t("#product-price")?.dataset?.base||t("#product-price")?.textContent,Number(String(c||0).replace(/[^\d]/g,""))||0);var c;const d=Number(t("#quantity")?.value||1);if(!i)return console.warn("no product id"),!1;const s=function(){const t=[],e=document.getElementById("product-options");return e?(e.querySelectorAll("button[data-choice-id], button[data-choice-id]").forEach((e=>{try{if(e.disabled)return;if("true"===e.getAttribute("aria-pressed")){const r=e.dataset.choiceId||e.dataset.id||e.getAttribute("data-id")||e.textContent.trim(),a=e.dataset.label||e.textContent.trim(),i=Number(String(e.dataset.price||e.getAttribute("data-price")||e.dataset.priceDelta||0).replace(/[^\d\-]/g,""))||0;t.push({id:String(r).replace(/_/g,"-"),label:a.trim(),price:i})}}catch(t){}})),e.querySelectorAll("input").forEach((r=>{try{if(r.disabled)return;if("checkbox"===r.type&&r.checked||"radio"===r.type&&r.checked){const a=r.dataset.choiceId||r.id||r.name+"_"+r.value,i=r.dataset.label||e.querySelector(`label[for="${r.id}"]`)?.textContent?.trim()||a,n=Number(String(r.dataset.price||r.getAttribute("data-price")||0).replace(/[^\d\-]/g,""))||0;t.push({id:String(a).replace(/_/g,"-"),label:i.trim(),price:n})}}catch(t){}})),e.querySelectorAll("select").forEach((e=>{try{if(e.disabled)return;const r=e.options[e.selectedIndex];if(r&&!r.disabled){const a=Number(String(r.dataset.price||r.getAttribute("data-price")||r.dataset.price||0).replace(/[^\d\-]/g,""))||0,i=r.text||r.value;t.push({id:(e.name||e.id)+"_"+(r.value||r.text),label:(e.dataset.label||i).trim(),price:a})}}catch(t){}}))):document.querySelectorAll("button[data-choice-id]").forEach((e=>{if("true"!==e.getAttribute("aria-pressed"))return;const r=e.dataset.choiceId||e.dataset.id||e.getAttribute("data-id")||e.textContent.trim(),a=e.dataset.label||e.textContent.trim(),i=Number(String(e.dataset.price||e.getAttribute("data-price")||0).replace(/[^\d\-]/g,""))||0;t.push({id:String(r).replace(/_/g,"-"),label:a.trim(),price:i})})),t}(),u=function(t,e,r){const a=(r||[]).reduce(((t,e)=>t+Number(e.price||0)),0),i=Number(t||0)+a;return{unit:i,subtotal:i*Math.max(1,Number(e||1)),addTotal:a}}(o,d,s),l=t(".product-image"),p=l&&l.tagName&&"img"===l.tagName.toLowerCase()?l.src:t(".product-image img")?.src||"",m={id:String(i),source:a,title:n,unitPrice:Number(u.unit||0),qty:Number(d||1),addons:Array.isArray(s)?s:[],subtotal:Number(u.subtotal||0),image:p||""};let b=function(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(t){return[]}}();var g;return b=function(t,e){const r=t=>(t.addons||[]).map((t=>t.id)).sort().join("|"),a=r(e);for(let i=0;i<t.length;i++)if(t[i].id===e.id&&r(t[i])===a)return t[i].qty=Number(t[i].qty||1)+Number(e.qty||1),t[i].subtotal=Number(t[i].subtotal||0)+Number(e.subtotal||0),t;return t.push(e),t}(b,m),g=b,localStorage.setItem("cart",JSON.stringify(g||[])),function(t="Added to bag"){let e=document.querySelector(".mini-toast");e||(e=document.createElement("div"),e.className="mini-toast",e.style.cssText="position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#111;color:#fff;padding:8px 12px;border-radius:8px;z-index:1600;opacity:0;transition:opacity .18s",document.body.appendChild(e)),e.textContent=t,e.style.opacity="1",setTimeout((()=>e.style.opacity="0"),1200)}("Item added to bag"),e&&setTimeout((()=>window.location.href="bagfr.html"),450),!0}document.addEventListener("click",(t=>{const r=t.target.closest&&t.target.closest(".add-btn, [data-add-to-bag]");if(!r)return;t.preventDefault();e(!r.hasAttribute("data-no-redirect"))})),window.addToBagFromPage=e,window.addToBag=e}(),function(){const t=t=>"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0));document.addEventListener("click",(function(e){if(!e.target.closest)return;if(!e.target.closest(".checkout, [data-checkout]"))return;e.preventDefault();const r=function(){try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch(t){return[]}}();if(!r.length)return void alert("Keranjang kosong");let a=0;const i=r.map((t=>(a+=Number(t.subtotal||0),{id:t.id,title:t.title,qty:t.qty,unitPrice:t.unitPrice,addons:t.addons||[],subtotal:t.subtotal}))),n={id:"ORD-"+(new Date).toISOString().slice(0,10)+"-"+Math.random().toString(36).slice(2,6),createdAt:Date.now(),status:"active",items:i,total:a},o=function(){try{return JSON.parse(localStorage.getItem("orders")||"[]")}catch(t){return[]}}();var c;o.unshift(n),c=o,localStorage.setItem("orders",JSON.stringify(c||[]));const d="https://api.whatsapp.com/send?text="+encodeURIComponent(function(e){const r=[];return r.push(`ðŸ“¦ New Order â€” ${e.id}`),r.push(`Waktu: ${new Date(e.createdAt).toLocaleString("id-ID")}`),r.push(""),e.items.forEach((e=>{const a=(e.addons||[]).map((e=>`${e.label} (+${t(e.price)})`)).join(", ");r.push(`â€¢ ${e.title} x${e.qty} â€” ${t(e.unitPrice)} ${a?" | "+a:""} = ${t(e.subtotal)}`)})),r.push(""),r.push(`Total: ${t(e.total)}`),r.push(""),r.push("Nama:"),r.push("No. HP:"),r.push("Alamat / Catatan:"),r.push(""),r.push("Mohon konfirmasi ketersediaan & instruksi pembayaran via chat. Terima kasih!"),r.join("\n")}(n));window.open(d,"_blank"),window.location.href="order.html?order="+encodeURIComponent(n.id)}))}()}();