// @ts-nocheck
import{db}from"./firebase-config.js";import{collection,query,where,orderBy,onSnapshot}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";!function(){const e=localStorage.getItem("maziUID")||null,r=(localStorage.getItem("maziEmail")||"").toLowerCase().trim();if(e||r)try{let t;t=query(collection(db,"orders"),e?where("userId","==",e):where("userEmail","==",r),orderBy("createdAt","desc")),onSnapshot(t,(e=>{const r=[];e.forEach((e=>{const t=e.data()||{};r.push(Object.assign({},t,{_firestoreId:e.id,id:t.id||e.id}))}));const t=(function(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}("orders")||[]).filter((e=>!r.some((r=>String(r.id)===String(e.id))))),o=[...r,...t].sort(((e,r)=>{const t=e.createdAt&&e.createdAt.seconds?e.createdAt.seconds:e.createdAt||0;return(r.createdAt&&r.createdAt.seconds?r.createdAt.seconds:r.createdAt||0)-t}));!function(e){try{localStorage.setItem("orders",JSON.stringify(e||[]))}catch(e){console.error(e)}}(o);try{window.dispatchEvent(new StorageEvent("storage",{key:"orders",newValue:JSON.stringify(o)}))}catch(e){}}),(e=>{console.warn("order-user-sync onSnapshot error",e)}))}catch(e){console.warn("order-user-sync init fail",e)}}();