// @ts-nocheck
!function(){"use strict";function t(t){try{return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}function e(t){try{localStorage.setItem("orders",JSON.stringify(t||[]))}catch(t){console.error("Failed to save orders",t)}}function n(t){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0))}function i(t){return String(t||"").replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])))}function a(){return t("orders")}let d="all";function s(t,e){let n;try{n=JSON.parse(localStorage.getItem("notifications_v1")||"[]")}catch(t){n=[]}const i=new Date;let a="",d="",s="";"approved"===e?(a="Payment Confirmed",s="üí∏",d="Order "+(t.id||"")+" telah dikonfirmasi dan pembayaran sudah diterima admin."):"rejected"===e&&(a="Order Rejected",s="‚õî",d="Order "+(t.id||"")+" telah ditolak / dibatalkan oleh admin.");const r={id:"adm-"+e+"-"+(t.id||"")+"-"+i.getTime(),title:a,message:d,emoji:s,time:"Just now",isRead:!1};n.unshift(r);try{localStorage.setItem("notifications_v1",JSON.stringify(n))}catch(t){console.error("Failed to save notifications",t)}}function r(){const l=document.getElementById("order-list");if(!l)return;l.innerHTML="";let o=a()||[];o=o.filter((t=>"cancelled"!==String(t.status||"").toLowerCase())),"history"===d?o=o.filter((t=>"completed"===String(t.status||"").toLowerCase())):(o=o.filter((t=>"completed"!==String(t.status||"").toLowerCase())),"gift"===d&&(o=o.filter((t=>!!t.isGift&&!!t.gift)))),o.length?o.forEach((d=>{l.appendChild(function(d){const l=document.createElement("article");l.className="admin-order-card";const o=new Date(d.createdAt||Date.now()).toLocaleString(),c=(d.status||"active").toLowerCase(),m=(d.paymentStatus||"pending").toLowerCase();"completed"===c?l.classList.add("is-completed"):"paid"===m&&l.classList.add("is-paid");const v=!!d.isGift&&!!d.gift;v&&l.classList.add("gift");let u="";if(d.scheduledAt)try{u=new Date(d.scheduledAt).toLocaleString("id-ID")}catch(t){}const p=d.items&&d.items[0]?d.items[0]:null,g=p?p.title||p.name||"":"(no items)",f=d.meta&&"string"==typeof d.meta.recipient?d.meta.recipient.trim():"",b=t("savedAddresses_v1");let y=null;Array.isArray(b)&&b.length&&(y=b.find((t=>t&&t.isDefault))||b[0]);let h="";if(f){h=`\n        <div class="admin-address">\n          <div class="admin-address-title">Recipient</div>\n          <div class="admin-address-main">\n            <div>${i(f).replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}else if(y){const t=i(y.label||""),e=i(y.name||""),n=i(y.phone||"");h=`\n        <div class="admin-address">\n          <div class="admin-address-title">Address</div>\n          <div class="admin-address-main">\n            <div>${`${t||""}${t&&e?" - ":""}${e||""}`}</div>\n            ${n?`<div>${n}</div>`:""}\n            <div>${i(y.address||"").replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}let S="";if(v){const t="surprise"===String(d.gift.revealMode||"reveal")?"Keep it a surprise":"Reveal it now";S=`\n        <div class="admin-gift-block">\n          <div class="admin-gift-title">üéÅ Gift order</div>\n          ${d.gift.message?`<div class="admin-gift-line"><strong>Message:</strong> ${i(d.gift.message)}</div>`:""}\n          ${d.gift.fromName?`<div class="admin-gift-line"><strong>From:</strong> ${i(d.gift.fromName)}</div>`:""}\n          <div class="admin-gift-line"><strong>Reveal:</strong> ${i(t)}</div>\n          ${u?`<div class="admin-gift-line"><strong>Schedule:</strong> ${i(u)}</div>`:""}\n        </div>\n      `}let $="";(d.items||[]).forEach((t=>{if(!t)return;const e=i(t.title||t.name||""),a=t.addons&&t.addons.length?'<div class="admin-item-addons">'+t.addons.map((t=>i(t.label||""))).join(", ")+"</div>":"",d=Number(t.qty||0),s=Number(t.unitPrice||t.price||0),r=Number(t.subtotal||s*d),l=d+" √ó "+n(s)+" = "+n(r);$+=`\n        <div class="admin-item-row">\n          <div class="admin-item-main">\n            <div class="admin-item-title">${e}</div>\n            ${a}\n            <div class="admin-item-price">${i(l)}</div>\n          </div>\n        </div>\n      `}));const L="paid"===m?"badge-payment paid":"rejected"===m?"badge-payment rejected":"badge-payment";l.innerHTML=`\n      <div class="admin-order-header">\n        <div>\n          <div class="admin-order-id">Order ID: ${i(d.id||"(no id)")}</div>\n          <div class="admin-order-created">${i(o)}</div>\n        </div>\n        <div class="admin-order-total">\n          <span class="admin-total-label">Total</span>\n          <span class="admin-total-value">${n(d.total)}</span>\n        </div>\n      </div>\n\n      <div class="admin-status-row">\n        <span class="badge badge-status">${i(c)}</span>\n        <span class="badge ${L}">${i(m)}</span>\n      </div>\n\n      <div class="admin-summary-row">\n        <span class="summary-chip">${v?"üéÅ Gift":"Order"}</span>\n        <span class="summary-main">${i(g)}</span>\n        ${u&&v?`<span class="summary-schedule"> ¬∑ ${i(u)}</span>`:""}\n        <button type="button" class="btn-toggle-detail" aria-expanded="false">\n          Detail\n        </button>\n      </div>\n\n      <div class="admin-details">\n        ${S}\n        <div class="admin-items">\n          ${$}\n        </div>\n        ${h}\n        <div class="admin-actions">\n          <button class="btn btn-approve" data-id="${i(d.id)}">ACC (sudah dibayar)</button>\n          <button class="btn btn-reject" data-id="${i(d.id)}">Tolak order</button>\n          <button class="btn btn-delivered" data-id="${i(d.id)}">Mark as delivered</button>\n        </div>\n      </div>\n    `;const w=l.querySelector(".btn-approve"),D=l.querySelector(".btn-reject"),k=l.querySelector(".btn-delivered"),A=l.querySelector(".admin-details"),E=l.querySelector(".btn-toggle-detail");A&&(window.innerWidth<600?(A.classList.add("collapsed"),E&&(E.setAttribute("aria-expanded","false"),E.textContent="Detail")):(A.classList.remove("collapsed"),E&&(E.setAttribute("aria-expanded","true"),E.textContent="Sembunyikan")));E&&A&&E.addEventListener("click",(function(t){t.stopPropagation();const e=A.classList.toggle("collapsed");this.setAttribute("aria-expanded",String(!e)),this.textContent=e?"Detail":"Sembunyikan"}));"completed"===c||"cancelled"===c?(w&&(w.style.display="none"),D&&(D.style.display="none"),k&&(k.style.display="none")):"paid"===m?(w&&(w.style.display="none"),D&&(D.style.display="none")):k&&(k.style.display="none");w&&w.addEventListener("click",(function(t){t.stopPropagation();const n=this.dataset.id,i=a(),d=i.findIndex((t=>String(t.id)===String(n)));-1!==d&&(i[d].paymentStatus="paid",i[d].status||(i[d].status="active"),s(i[d],"approved"),e(i),r(),alert("Order di-set sebagai SUDAH DIBAYAR."))}));D&&D.addEventListener("click",(function(t){t.stopPropagation();const n=this.dataset.id,i=a(),d=i.findIndex((t=>String(t.id)===String(n)));-1!==d&&(i[d].paymentStatus="rejected",i[d].status="cancelled",s(i[d],"rejected"),e(i),r(),alert("Order telah DITOLAK / dibatalkan oleh admin."))}));k&&k.addEventListener("click",(function(t){t.stopPropagation();const n=this.dataset.id,i=a(),d=i.findIndex((t=>String(t.id)===String(n)));if(-1!==d){if("paid"!==String(i[d].paymentStatus||"").toLowerCase())return void alert("Order harus sudah dibayar sebelum ditandai sebagai delivered.");i[d].status="completed",e(i),r(),alert("Order ditandai sebagai DELIVERED dan pindah ke History.")}}));return l.addEventListener("click",(function(t){if(t.target.closest(".admin-actions")||t.target.closest(".btn-toggle-detail"))return;if("paid"!==m)return;const e=d.id||"";e&&(window.location.href="diteladm.html?id="+encodeURIComponent(e))})),l}(d))})):l.innerHTML='<div style="color:#777;font-size:13px;">Belum ada order.</div>'}document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelectorAll(".admin-pill");t.length&&t.forEach((e=>{e.addEventListener("click",(()=>{const n=e.dataset.filter||"all";d=n,t.forEach((t=>t.classList.remove("is-active"))),e.classList.add("is-active"),r()}))})),r()}))}();