// @ts-nocheck
import{db}from"./firebase-config.js";import{collection,query,orderBy,onSnapshot}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";!function(){function t(t){const e=function(t){try{return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}("orders")||[],r={};e.forEach((t=>{t&&t.id&&(r[String(t.id)]=t)})),t.forEach((t=>{const e=String(t.id||t._firestoreId||t._id||"");if(!e)return;const s=r[e];if(s){const o={paymentStatus:s.paymentStatus||t.paymentStatus||"pending",status:s.status||t.status||"active"};r[e]=Object.assign({},t,o,{id:e})}else r[e]=Object.assign({},t,{id:e})}));const s=Object.values(r).sort(((t,e)=>{const r=t.createdAt&&t.createdAt.seconds?t.createdAt.seconds:t.createdAt||0;return(e.createdAt&&e.createdAt.seconds?e.createdAt.seconds:e.createdAt||0)-r}));!function(t){try{localStorage.setItem("orders",JSON.stringify(t||[]))}catch(t){console.error("saveLocalOrders failed",t)}}(s);try{window.dispatchEvent(new StorageEvent("storage",{key:"orders",newValue:JSON.stringify(s)}))}catch(t){}}try{const e=query(collection(db,"orders"),orderBy("createdAt","desc"));onSnapshot(e,(e=>{const r=[];e.forEach((t=>{const e=t.data()||{};r.push(Object.assign({},e,{_firestoreId:t.id,id:e.id||t.id}))})),t(r)}),(t=>{console.warn("ordadm-sync onSnapshot error",t)}))}catch(t){console.warn("ordadm-sync init failed",t)}}();